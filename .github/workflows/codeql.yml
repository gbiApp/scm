# ... (Before this, you have: checkout, init, autobuild)

    steps:
      # ... (Steps 1 & 2: checkout, init, autobuild remain the same)

      # 3. Perform CodeQL Analysis and Save SARIF (NO CHANGES HERE)
      - name: üîç Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3
        with:
          # This saves the file as codeql-results/<language>.sarif
          output: codeql-results 
          
      # --- START OF CRITICAL FIX ---

      - name: üîÑ Rename CodeQL SARIF for SOOS Ingestion (FIX FOR ERROR 1)
        # Assuming JavaScript is your language. CHANGE THIS if you use another language.
        run: |
          CODEQL_SARIF_FILE="codeql-results/javascript.sarif"
          SOOS_REQUIRED_FILE="codeql-results/javascript.sarif.json"
          
          if [ -f "$CODEQL_SARIF_FILE" ]; then
            mv "$CODEQL_SARIF_FILE" "$SOOS_REQUIRED_FILE"
            echo "Successfully renamed $CODEQL_SARIF_FILE to $SOOS_REQUIRED_FILE"
          else
            echo "Warning: CodeQL SARIF file not found at $CODEQL_SARIF_FILE. Skipping rename."
          fi

      - name: ‚¨ÜÔ∏è Upload CodeQL SARIF to SOOS (FIX FOR ERROR 2)
        if: always() # Run this step regardless of prior success/failure
        uses: soos-io/soos-sast-github-action@v1 # Check SOOS documentation for latest version
        with:
          client_id: ${{ secrets.SOOS_CLIENT_ID }}
          api_key: ${{ secrets.SOOS_API_KEY }}
          project_name: ${{ github.repository }} 
          build_version: ${{ github.sha }}
          # üö® CRITICAL: Use the specific, renamed file path
          scan_file: codeql-results/javascript.sarif.json 
          scan_type: SARIF 
          
      # --- END OF CRITICAL FIX ---

      # 4. Upload SARIF to GitHub Security Tab (REQUIRED FOR GITHUB UI)
      # This step should remain as it handles the CodeQL UI view.
      - name: üì¶ Upload CodeQL SARIF to GitHub
        uses: github/codeql-action/upload-sarif@v3
        if: always()
        with:
          sarif_file: codeql-results/*.sarif
