import{r as b,W as Y,j as e,Y as J,a as K}from"./app-DDEFgIQ0.js";import{A as X}from"./AuthenticatedLayout-CAhfjy0K.js";import{T as Z,a as ee,b as j,c as C}from"./tabs-Ds5wNEnO.js";import{B as te}from"./button-BwX_C8iK.js";import{T as V}from"./textarea-CaFSZuMs.js";import{L as p,I as x}from"./input-E2GEvTx_.js";import{S as re,a as ae,b as ie,c as oe,d as se}from"./select-BGyJcZEt.js";/* empty css              */import{s as I}from"./SelectComponent-CTvlit3o.js";import{d as r}from"./index-Dgu5UXxG.js";import{u as de,T as le}from"./toaster-ZLvP_WFp.js";import{f as ne}from"./utils-BuC82Owh.js";import{D as ue}from"./Dropzone-ScOuBj5j.js";import"./ApplicationLogo-WA2idasH.js";import"./transition-Bb5EmCqw.js";import"./x-CpBu2b5F.js";import"./index-Frm3adN9.js";import"./index-ByOl0Zen.js";import"./Combination-D0O_qMDO.js";import"./useStateManager-7e1e8489.esm-CcX6sTzc.js";import"./react-select.esm-BXpW4rXw.js";const Re=({auth:n,mat_code:E,mat_desc:G})=>{var P;const M=new Date().toLocaleDateString(),{toast:c}=de(),[q,U]=b.useState([]),[s,N]=b.useState([{sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,total_value:void 0,currency:void 0,del_date:void 0,mat_grp:void 0,purch_grp:void 0},{sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,total_value:void 0,currency:void 0,del_date:void 0,mat_grp:void 0,purch_grp:void 0},{sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,currency:void 0,total_value:void 0,del_date:void 0,mat_grp:void 0,purch_grp:void 0}]),{data:l,setData:m,post:A,errors:k,reset:ce,processing:B}=Y({id:0,pr_number:"",created_name:n.user.name,doc_date:M,requested_by:n.user.name,plant:n.user.plants!==void 0?(P=n.user.plants[0])==null?void 0:P.plant:"",reason_pr:"",header_text:"",attachment:void 0,total_pr_value:0,status:"",deliv_addr:"",prmaterials:[]}),L=[{...r.keyColumn("sel",r.checkboxColumn),title:"Sel",minWidth:30},{...r.keyColumn("status",r.textColumn),title:"Sts",disabled:!0,minWidth:35},{...r.keyColumn("item_no",r.intColumn),title:"ItmNo",disabled:!0,minWidth:55},{...r.keyColumn("mat_code",I({choices:E})),title:"Material",minWidth:120},{...r.keyColumn("short_text",I({choices:G})),title:"Short Text",minWidth:300},{...r.keyColumn("qty",r.floatColumn),title:"Qty",minWidth:70},{...r.keyColumn("ord_unit",r.textColumn),title:"Ord Unit",minWidth:55},{...r.keyColumn("price",r.floatColumn),title:"Price",minWidth:70,disabled:!0},{...r.keyColumn("per_unit",r.floatColumn),title:"Per Unit",minWidth:30,disabled:!0},{...r.keyColumn("unit",r.textColumn),title:"Unit",minWidth:40,disabled:!0},{...r.keyColumn("total_value",r.floatColumn),title:"Total Value",minWidth:90,disabled:!0},{...r.keyColumn("currency",r.textColumn),title:"Curr",minWidth:50,disabled:!0},{...r.keyColumn("del_date",r.dateColumn),title:"Del Date",minWidth:130},{...r.keyColumn("mat_grp",r.textColumn),title:"Mat Grp",minWidth:150,disabled:!0},{...r.keyColumn("purch_grp",r.textColumn),title:"Purch Grp",minWidth:150,disabled:!0}],$={"--dsg-header-text-color":"rgb(10, 10, 10)","--dsg-cell-disabled-background-color":"rgb(245, 245, 245)","--dsg-border-color":"#bfbdbd"},T=async a=>{try{return(await window.axios.get(route("material.details"),{params:{material:a,plant:l.plant}})).data.data}catch(d){return console.error("Error fetching material info:",d),null}},O=async(a,d)=>{var v,_,h,i,y,S,W,F,R,D;const u=[...a],f=[...s];for(const g of d)if(g.type==="UPDATE"){const t=u[g.fromRowIndex],w=f[g.fromRowIndex];if(t.mat_code&&t.mat_code!==w.mat_code){const o=await T(t.mat_code);o&&(t.short_text=o.mat_desc,t.ord_unit=o.base_uom,t.unit=o.base_uom,t.price=parseFloat(((v=o.valuations[0])==null?void 0:v.valuation_price)||0),t.currency=((_=o.valuations[0])==null?void 0:_.currency)||"",t.per_unit=parseFloat(((h=o.valuations[0])==null?void 0:h.per_unit)||0),t.mat_grp=((i=o.materialGroups[0])==null?void 0:i.mat_grp_code)||"",t.purch_grp=((y=o.purchasingGroups[0])==null?void 0:y.purch_grp)||"",t.total_value=t.price*(t.qty||0))}if(t.short_text&&t.short_text!==w.short_text){const o=await T(t.short_text);o&&(t.altUom=o.altUoms.map(Q=>Q.alt_uom),t.mat_code=o.mat_code,t.ord_unit=o.base_uom,t.unit=o.base_uom,t.price=parseFloat(((S=o.valuations[0])==null?void 0:S.valuation_price)||0),t.currency=((W=o.valuations[0])==null?void 0:W.currency)||"",t.per_unit=parseFloat(((F=o.valuations[0])==null?void 0:F.per_unit)||0),t.mat_grp=((R=o.materialGroups[0])==null?void 0:R.mat_grp_code)||"",t.purch_grp=((D=o.purchasingGroups[0])==null?void 0:D.purch_grp)||"",t.total_value=t.price*(t.qty||0))}t.qty!==w.qty&&(t.total_value=(t.price??0)/(t.per_unit??0)*(t.qty??0)),t.item_no=(g.fromRowIndex+1)*10}N(u),m({...l,prmaterials:u})},H=async a=>{a.preventDefault(),z()&&A(route("pr.store"))},z=()=>{var f,v,_,h;const a=new Date;let d=!0;const u=s.filter(i=>i.mat_code!==void 0).map((i,y)=>({...i,item_no:(y+1)*10}));if(N(u),u.length<=0)return c({variant:"destructive",description:"Please add atleast 1 item"}),!1;for(let i=0;i<s.length;i++)if(s[i].mat_code!==void 0&&s[i].mat_code!==""){if(s[i].qty===void 0||((f=s[i])==null?void 0:f.qty)<=0){c({variant:"destructive",description:`Please enter quantity for item no ${s[i].item_no}`}),d=!1;break}if(s[i].ord_unit===void 0||((v=s[i])==null?void 0:v.ord_unit)===null){c({variant:"destructive",description:`Please enter order unit for item no ${s[i].item_no}`}),d=!1;break}if(s[i].del_date===void 0||((_=s[i])==null?void 0:_.del_date)===null){c({variant:"destructive",description:`Please enter delivery date for item no ${s[i].item_no}`}),d=!1;break}else if(((h=s[i].del_date)==null?void 0:h.getTime())<=a.getTime()){c({variant:"destructive",description:`Please enter delivery date greater than today for item no ${s[i].item_no}`}),d=!1;break}}return d};return b.useEffect(()=>{const a=s.reduce((d,u)=>d+(u.total_value||0),0);m(d=>({...d,total_pr_value:a,attachment:q}))},[s,q]),b.useEffect(()=>{k.hasOwnProperty("error")&&c({variant:"destructive",description:k.error})},[k]),e.jsxs(X,{user:n.user,menus:n.menu,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Create Purchase Requisition"}),children:[e.jsx(J,{title:"PR Create"}),e.jsx(le,{}),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-2",children:e.jsx("div",{className:"bg-gray-50 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"p-5 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-auto",children:[e.jsx(p,{htmlFor:"prnumber",children:"PR Number"}),e.jsx(x,{type:"text",id:"prnumber",defaultValue:l.pr_number,disabled:!0})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(p,{htmlFor:"createdby",children:"Created By"}),e.jsx(x,{type:"text",id:"createdby",defaultValue:l.created_name,disabled:!0})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(p,{htmlFor:"date",children:"Date"}),e.jsx(x,{type:"text",id:"date",defaultValue:l.doc_date,disabled:!0})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(p,{htmlFor:"requested_by",children:"Requested By"}),e.jsx(x,{type:"text",id:"requested_by",value:l.requested_by,required:!0,onChange:a=>m("requested_by",a.target.value)})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(p,{htmlFor:"requestingPlant",children:"Requesting Plant"}),e.jsxs(re,{defaultValue:l.plant,onValueChange:a=>m("plant",a),children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:"Plant"})}),e.jsx(oe,{children:n.user.plants&&n.user.plants.map(a=>e.jsxs(se,{value:a.plant,children:[a.plant," ",a.name1]},a.plant))})]})]})]}),e.jsx("div",{className:"p-1 pt-0",children:e.jsxs(Z,{defaultValue:"reasonForPr",className:"max-w-8xl",children:[e.jsxs(ee,{children:[e.jsx(j,{value:"reasonForPr",children:"Reason for PR"}),e.jsx(j,{value:"headerText",children:"Header Text"}),e.jsx(j,{value:"workflow",children:"Workflow"}),e.jsx(j,{value:"attachment",children:"Attachment"})]}),e.jsx(C,{value:"reasonForPr",children:e.jsx(V,{value:l.reason_pr,onChange:a=>m("reason_pr",a.target.value),required:!0})}),e.jsx(C,{value:"headerText",children:e.jsx(V,{value:l.header_text,onChange:a=>m("header_text",a.target.value)})}),e.jsx(C,{value:"workflow"}),e.jsx(C,{value:"attachment",children:e.jsx(ue,{files:q,setFiles:U})})]})}),e.jsx("div",{className:"p-2",children:e.jsx(r.DataSheetGrid,{createRow:()=>({sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,total_value:void 0,currency:void 0,del_date:void 0,mat_grp:void 0}),value:s,onChange:O,columns:L,style:$,autoAddRow:!0,disableExpandSelection:!0,rowHeight:30,className:"text-sm"})}),e.jsxs("div",{className:"float-right -mt-12 mr-72  flex gap-2 justify-end content-center",children:[e.jsx("div",{className:"",children:e.jsx(p,{htmlFor:"total",children:"Total PR Value: "})}),e.jsx("div",{children:e.jsx(x,{type:"text",value:ne(l.total_pr_value),readOnly:!0,disabled:!0})})]}),e.jsx("div",{className:"p-2 pt-0",children:e.jsx("div",{className:"p-5 justify-end grid grid-cols-8 gap-4",children:n.permissions.pr.create&&e.jsxs(e.Fragment,{children:[e.jsx(te,{variant:"outline",disabled:B,className:"bg-[#f8c110]  hover:border-gray-500 hover:bg-[#f8c110] ",children:"Save"}),e.jsx(K,{href:route("pr.index"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2  border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-500",children:"Cancel"})]})})})]})})})})]})};export{Re as default};
