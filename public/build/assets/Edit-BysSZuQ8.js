import{j as t,r as m,W as $,a as y,Y as ee}from"./app-9BfIP8Yt.js";import"./tabs-CSAEFCKf.js";import{B as te}from"./button-UluEiDe7.js";import{T as V}from"./textarea-WPr4wz2o.js";import{L as se,I as re}from"./input-B6LatCgn.js";import{u as oe,T as ie}from"./toaster-C-nH-nj2.js";import"./select-BlE8HqPq.js";import{I as b}from"./InputField-BbCt2qk6.js";import{A as le}from"./AuthenticatedLayout-DNrtgEyS.js";/* empty css              */import{d as r}from"./index-f1KWvzcE.js";import{S as f,C as ae,a as P,b as ne,c as j,d as C}from"./constants-Co51-129.js";import{A as de,u as ue}from"./AddPrtoPo-BTcz5ecg.js";import{u as ce,V as me,R as pe}from"./usePOMaterialValidation-CjORHRXk.js";import{S as w,D as be,T as W}from"./TabFields-CC_gKAQi.js";import{A as ve,G as _e,F as D,D as fe}from"./AttachmentList-C4qDL1S6.js";import{f as xe}from"./utils-BSdE8tDE.js";import k from"./Approval-CIDHBW-X.js";import"./toast-SiKyGAR4.js";import"./index-CzvjeGZW.js";import"./useStateManager-7e1e8489.esm-9tTtCMRh.js";import"./react-select.esm-R1G1BB6e.js";import"./ApplicationLogo-BHU32V6c.js";import"./transition-6Z6DAD7I.js";import"./Modal-DTHE29Ut.js";import"./SecondaryButton-Cc1rzZy3.js";import"./PrimaryButton-BuizIAGH.js";const ge=({href:a})=>t.jsx("a",{className:"text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 shadow-lg shadow-green-500/50 dark:shadow-lg dark:shadow-green-800/80 font-medium rounded-lg text-sm p-1 text-center",href:a,target:"_blank",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0 1 10.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0 .229 2.523a1.125 1.125 0 0 1-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0 0 21 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 0 0-1.913-.247M6.34 18H5.25A2.25 2.25 0 0 1 3 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 0 1 1.913-.247m10.5 0a48.536 48.536 0 0 0-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5Zm-3 0h.008v.008H15V10.5Z"})})}),Qe=({auth:a,vendors:N,poheader:s,message:d,deliveryAddress:E,supplierNotes:O})=>{var A;const{toast:x}=oe(),[u,M]=m.useState(),[F,q]=m.useState(s.vendors),[g,S]=m.useState([]),{computeConversion:T,updateMaterialPO:R,getVendorInfo:U}=ue(),{validateMaterials:B}=ce(),[n,v]=m.useState(s.pomaterials.map(e=>{var o,l;return{...e,...T(e,e.unit??"",s.vendor_id),altUomSelect:[...new Set([e.unit,...(o=e==null?void 0:e.alt_uom)==null?void 0:o.map(p=>p.alt_uom)])],del_date:new Date(e.del_date||""),origPOQty:e.po_qty??0,mat_grp_desc:((l=e.materialGroups)==null?void 0:l.mat_grp_desc)||""}})),{data:i,setData:c,post:L,errors:h,reset:H,processing:K}=$({id:s.id,po_number:s.po_number,control_no:s.control_no,vendor_id:s.vendor_id,vendors:s.vendors,created_name:s.created_name,doc_date:s.doc_date,deliv_date:s.deliv_date,notes:s.notes,plant:s.plant,header_text:s.header_text,approver_text:s.approver_text,attachment:void 0,total_po_value:s.total_po_value,deliv_addr:s.deliv_addr,pomaterials:[],_method:"patch"}),I=m.useMemo(()=>[{...r.keyColumn("sel",r.checkboxColumn),title:"Sel",minWidth:30},{...r.keyColumn("status",r.textColumn),title:"Sts",minWidth:35,disabled:!0},{...r.keyColumn("item_no",r.intColumn),title:"ItmNo",minWidth:55,disabled:!0},{...r.keyColumn("mat_code",r.textColumn),title:"Material",minWidth:120,disabled:!0},{...r.keyColumn("short_text",r.textColumn),title:"Short Text",minWidth:300,disabled:!0},{...r.keyColumn("item_text",r.textColumn),title:"Item Text",minWidth:300},{...r.keyColumn("po_qty",r.floatColumn),title:"PO Qty",minWidth:70,disabled:({rowData:e})=>e.po_gr_qty!=e.po_qty},{...r.keyColumn("qty_open_po",r.floatColumn),title:"Open Qty",minWidth:100,disabled:!0},{...r.keyColumn("altUomSelect",{component:({rowData:e,rowIndex:o})=>e&&t.jsx("select",{className:"border-none w-full shadow-none bg-none px-1 py-0 active:border-none hover:border-none",onChange:l=>{v(p=>{const _=[...p];return _[o]={..._[o],...T(_[o],l.target.value)},_})},children:e.map((l,p)=>t.jsx("option",{value:l,children:l},p))})}),title:"Alt UOM"},{...r.keyColumn("unit",r.textColumn),title:"Ord. UOM",minWidth:55,disabled:!0},{...r.keyColumn("pr_unit",r.textColumn),title:"B. UOM",minWidth:55,disabled:!0},{...r.keyColumn("net_price",r.floatColumn),title:"Net Price",minWidth:80,disabled:({rowData:e})=>!!e.item_free},{...r.keyColumn("per_unit",r.intColumn),title:"Per Unit",minWidth:50,disabled:({rowData:e})=>!!e.item_free},{...r.keyColumn("total_value",r.intColumn),title:"Total Value",minWidth:120,disabled:!0},{...r.keyColumn("item_free",r.checkboxColumn),title:"Free",minWidth:70},{...r.keyColumn("currency",r.textColumn),title:"Curr",minWidth:55,disabled:!0},{...r.keyColumn("del_date",r.dateColumn),title:"Del Date",minWidth:120},{...r.keyColumn("mat_grp_desc",r.textColumn),title:"Mat Grp",minWidth:200,disabled:!0},{...r.keyColumn("requested_by",r.textColumn),title:"Requested By",minWidth:150},{...r.keyColumn("pr_number",r.textColumn),title:"PR Number",minWidth:120,disabled:!0}],[]),G=m.useMemo(()=>[{header:"Position",accessor:e=>e.position},{header:"Status",accessor:e=>e.status},{header:"Approved By",accessor:e=>e.approved_by},{header:"Approved Date",accessor:e=>e.approved_date},{header:"Remarks",accessor:e=>e.message}],[]),Q=[{value:"header_text",label:"Header Text",visible:!0,content:t.jsx(V,{value:i.header_text,onChange:e=>c("header_text",e.target.value)})},{value:"approver_text",label:"Remarks",visible:!0,content:t.jsx(V,{value:i.header_text,onChange:e=>c("header_text",e.target.value)})},{value:"notes",label:"Notes",visible:!0,content:t.jsx(w,{items:O,valueKey:"value",displayKey:"label",onValueChange:e=>c("notes",e),value:i.notes})},{value:"deliveryAddress",label:"Delivery Address",visible:!0,content:t.jsx(w,{items:E,valueKey:"value",displayKey:"label",onValueChange:e=>c("deliv_addr",e),value:i.deliv_addr})},{value:"attachment",label:"Attachment",visible:!0,content:t.jsxs(t.Fragment,{children:[t.jsx(ve,{attachments:s.attachments,canEdit:a.permissions.po.edit}),t.jsx(be,{files:g,setFiles:S}),","]})},{value:"workflow",label:"Workflow",visible:((A=s.workflows)==null?void 0:A.length)>0,content:t.jsx(_e,{columns:G,data:s.workflows,className:"w-11/2 text-xs bg-white"})},{value:"vendor",label:"Vendor Info",visible:!0,content:t.jsx(me,{vendor:F})}],z=[{value:"action",label:"Action",visible:a.permissions.po.edit,content:t.jsxs(t.Fragment,{children:[t.jsx(y,{preserveScroll:!0,href:route("po.update-controlno"),data:{id:s.id,control_no:i.control_no},as:"button",type:"button",className:"p-2 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-100 ",children:"Update Control No."}),t.jsx(D,{p_description:"Are you sure you want to flag delete this item(s)?",p_title:"Flag for Delete",p_url:route("po.flag.delete"),p_disable:n.filter(e=>e.sel==!0).length==0,p_items:{ids:n.filter(e=>e.sel==!0).map(e=>e.id)}}),t.jsx(D,{p_description:"Are you sure you want to flag delivered this item(s)?",p_title:"Flag Delivered",p_url:route("po.flag.deliver"),p_disable:n.filter(e=>e.sel==!0).length==0,p_items:{ids:n.filter(e=>e.sel==!0).map(e=>e.id)}})]})}],J=e=>{v([...n,...e])},Y=(e,o)=>{const l=R(e,o,!0);v(l)};m.useEffect(()=>{d!=null&&d.success&&x({title:d.success}),d!=null&&d.error&&x({variant:"destructive",title:d.error}),a.user.approvers&&M(a.user.approvers.filter(e=>e.type=="po")[0])},[d]),m.useEffect(()=>{const e=n.filter(o=>(o==null?void 0:o.status)!="X").reduce((o,l)=>o+(l.total_value||0),0);c(o=>({...o,total_po_value:e,attachment:g,pomaterials:n}))},[n,g]),m.useEffect(()=>{h.hasOwnProperty("error")&&x({variant:"destructive",description:h.error})},[h]);const Z=async e=>{const o=await U(e);q(o)},X=async e=>{e.preventDefault();const{isValid:o,updatedMaterials:l}=B(n);v(l),o&&L(route("po.update",s.id),{preserveScroll:!0,onSuccess:p=>{H(),S([])}})};return t.jsxs(le,{user:a.user,menus:a.menu,header:t.jsxs("div",{className:"flex flex-row justify-between",children:[t.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Edit Purchase Order"}),s.status==f&&t.jsx(ge,{href:route("po.print",s.id)})]}),children:[t.jsx(ee,{title:"Edit PO"}),t.jsx(ie,{}),t.jsx("div",{className:"py-2",children:t.jsx("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-2",children:t.jsxs("div",{className:"bg-gray-50 overflow-hidden shadow-sm sm:rounded-lg",children:[t.jsxs("form",{onSubmit:X,children:[t.jsxs("div",{className:"p-5 flex flex-wrap gap-4",children:[t.jsx(b,{label:"PO Number",id:"prnumber",disabled:!0,defaultValue:i.po_number}),t.jsx(b,{label:"Control No.",id:"control_no",defaultValue:i.control_no,onChange:e=>c("control_no",e.target.value),type:"number"}),t.jsx(b,{label:"Created By",id:"created_by",defaultValue:i.created_name,disabled:!0}),t.jsx(b,{label:"Doc Date By",id:"doc_date",defaultValue:i.doc_date,disabled:!0}),t.jsx(b,{label:"Delivery Date",id:"deliv_date",defaultValue:i.deliv_date,onChange:e=>c("deliv_date",e.target.value),required:!0,type:"date",className:"w-40"}),t.jsx(w,{label:"Requesting Plant",items:a.user.plants,valueKey:"plant",displayKey:"name1",onValueChange:e=>c("plant",e),value:i.plant}),t.jsx(pe,{label:"Vendor",value:N.find(({value:e})=>e===i.vendor_id)??null,options:N,required:!0,className:"flex-none w-96",onChange:({value:e,label:o})=>{c({...i,vendor_id:e,vendor_name:o}),Z(e)}})]}),t.jsx("div",{className:"p-1 pt-0",children:t.jsx(W,{defaultValue:"header_text",className:"max-w-8xl",tabs:Q})}),t.jsx("div",{className:"p-2",children:t.jsx(r.DataSheetGrid,{value:n,onChange:Y,columns:I,style:ae,disableExpandSelection:!0,rowHeight:30,className:"text-sm"})}),t.jsxs("div",{className:"p-1 flex gap-2 justify-end content-center",children:[t.jsx("div",{className:"p-1",children:t.jsx(se,{htmlFor:"total",children:"Total PO Value: "})}),t.jsx("div",{children:t.jsx(re,{id:"total",type:"text",value:xe(i.total_po_value),readOnly:!0,disabled:!0})})]}),t.jsxs("div",{className:"p-2 pt-0",children:[t.jsx(W,{defaultValue:"action",className:"max-w-8xl",tabs:z}),t.jsx("div",{className:"p-5 justify-end grid grid-cols-8 gap-4",children:a.permissions.po.edit&&t.jsxs(t.Fragment,{children:[t.jsx(te,{variant:"outline",className:"bg-[#f8c110]  hover:border-gray-500 hover:bg-[#f8c110] disabled:cursor-not-allowed disabled:opacity-100 disabled:bg-gray-100",disabled:s.appr_seq==P||K,children:"Save"}),t.jsx(y,{href:route("po.index"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-100",children:"Cancel"}),t.jsx(y,{disabled:s.appr_seq!=ne,preserveScroll:!0,href:route("po.submit",s.id),as:"button",type:"button",className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none border border-input bg-[#f8c110] hover:bg-[#f8c110] hover:text-accent-foreground hover:border-gray-500
                        disabled:cursor-not-allowed disabled:opacity-100 disabled:bg-gray-100 `,children:"Submit"}),t.jsx(fe,{p_id:s.id,p_title:"Discard this Purchase Order ?",p_url:"po.discard",p_disable:s.appr_seq==P}),t.jsx(de,{p_vendor:i.vendor_id,p_plant:i.plant,p_doc_date:i.doc_date,addToPO:J})]})})]})]}),a.permissions.po.approver&&t.jsxs("div",{className:"px-5 pb-5",children:[t.jsx(k,{p_po_number:i.po_number,p_type:"approved",p_title:"approve",p_disable:s.status==f||s.status==j||s.status==C||(u==null?void 0:u.seq)!=s.appr_seq}),t.jsx(k,{p_po_number:i.po_number,p_type:"rework",p_title:"rework",p_disable:s.status==f||s.status==j||s.status==C||(u==null?void 0:u.seq)!=s.appr_seq}),t.jsx(k,{p_po_number:i.po_number,p_type:"rejected",p_title:"reject",p_disable:s.status==f||s.status==j||s.status==C||(u==null?void 0:u.seq)!=s.appr_seq})]})]})})})]})};export{Qe as default};
