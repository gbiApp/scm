import{r as j,W as oe,j as e,Y as de,a as k}from"./app-B0xb5DNB.js";import{A as ce}from"./AuthenticatedLayout-PecQUZue.js";import{T as U,a as $,b as _,c as v}from"./tabs-nE1YAE4e.js";import{B as ue}from"./button-BU5iTi24.js";import{T as z}from"./textarea-XU7y55H5.js";import{L as b,I as y}from"./input-D1d6vgBV.js";import{S as V,a as A,b as q,c as W,d as E}from"./select-BAYDQx0R.js";import{S as T,N as me,D as xe,T as Q,d as pe,b as C,e as w,a as G,c,f as he,g as F,h as R}from"./constants-CLvFqusw.js";/* empty css              */import fe from"./AddPrtoPo-po46GcWL.js";import{F as _e,D as ve}from"./Dropzone-D9xrIHHx.js";import{d as s}from"./index-8JG-8yYd.js";import{u as be,T as je}from"./toaster-CDnCc973.js";import{f as ge}from"./utils-CG2i-Alp.js";import{S as ye}from"./react-select.esm-CWLcAUIb.js";import{F as Y,D as Ce}from"./FlagForAction-CgOceQpZ.js";import O from"./Approval-QbVrWu33.js";import{C as we,a as Ne}from"./card-2ECn2PK8.js";import"./ApplicationLogo-WKTOXv7I.js";import"./transition-nICMswLC.js";import"./x-DigYKOUu.js";import"./index-Cm-6xkS1.js";import"./index-gE-_K1Hx.js";import"./Combination-1zvNIp3q.js";import"./useStateManager-7e1e8489.esm-z-LzugSL.js";import"./Modal-S2IAVDm4.js";import"./SecondaryButton-DIYSPt_4.js";import"./PrimaryButton-DHVacZWi.js";const et=({auth:u,vendors:N,poheader:r,message:x})=>{const{toast:p}=be(),[i,S]=j.useState(r.pomaterials.map(t=>({...t,del_date:new Date(t.del_date||""),qty_open:t.qty_open/(t.conversion/t.denominator)}))),[h,Z]=j.useState(),[d,I]=j.useState(r.vendors),[D,H]=j.useState([]),{data:l,setData:m,post:J,errors:P,reset:K,processing:X}=oe({id:r.id,po_number:r.po_number,control_no:r.control_no,vendor_id:r.vendor_id,vendors:r.vendors,created_name:r.created_name,doc_date:r.doc_date,deliv_date:r.deliv_date,notes:r.notes,plant:r.plant,header_text:r.header_text,approver_text:r.approver_text,attachment:void 0,total_po_value:r.total_po_value,deliv_addr:r.deliv_addr,pomaterials:[],_method:"patch"}),ee=[{...s.keyColumn("sel",s.checkboxColumn),title:"Sel",minWidth:30},{...s.keyColumn("status",s.textColumn),title:"Sts",minWidth:35,disabled:!0},{...s.keyColumn("item_no",s.intColumn),title:"ItmNo",minWidth:55,disabled:!0},{...s.keyColumn("mat_code",s.textColumn),title:"Material",minWidth:120,disabled:!0},{...s.keyColumn("short_text",s.textColumn),title:"Short Text",minWidth:300,disabled:!0},{...s.keyColumn("po_qty",s.floatColumn),title:"PO Qty",minWidth:70},{...s.keyColumn("qty_open",s.floatColumn),title:"Open Qty",minWidth:80,disabled:!0},{...s.keyColumn("unit",s.textColumn),title:"Unit",minWidth:55},{...s.keyColumn("net_price",s.floatColumn),title:"Net Price",minWidth:80,disabled:({rowData:t})=>!!t.item_free},{...s.keyColumn("per_unit",s.intColumn),title:"Per Unit",minWidth:50,disabled:({rowData:t})=>!!t.item_free},{...s.keyColumn("total_value",s.intColumn),title:"Total Value",minWidth:120,disabled:!0},{...s.keyColumn("item_free",s.checkboxColumn),title:"Free",minWidth:70},{...s.keyColumn("currency",s.textColumn),title:"Curr",minWidth:55,disabled:!0},{...s.keyColumn("del_date",s.dateColumn),title:"Del Date",minWidth:120},{...s.keyColumn("mat_grp",s.textColumn),title:"Mat Grp",minWidth:200,disabled:!0},{...s.keyColumn("requested_by",s.textColumn),title:"Requested By",minWidth:150},{...s.keyColumn("pr_number",s.textColumn),title:"PR Number",minWidth:120,disabled:!0},{...s.keyColumn("pr_item",s.textColumn),title:"PRItm",minWidth:70,disabled:!0},{...s.keyColumn("item_text",s.textColumn),title:"Item Text",minWidth:300}],te={"--dsg-header-text-color":"rgb(10, 10, 10)","--dsg-cell-disabled-background-color":"rgb(245, 245, 245)","--dsg-border-color":"#bfbdbd"},re=t=>{S([...i,...t])},se=(t,a)=>{const f=[...t];for(const g of a)if(g.type==="UPDATE"){const o=f[g.fromRowIndex];o.net_price=o.item_free?0:o.net_price,o.item_no=(g.fromRowIndex+1)*10,o.po_qty=o.po_qty<o.min_order_qty?o.min_order_qty:o.po_qty,o.converted_qty=o.po_qty*(o.conversion/o.denominator),o.total_value=(o.net_price??0)/(o.per_unit??0)*(o.po_qty??0)}S(f),m({...l,pomaterials:f})};j.useEffect(()=>{x!=null&&x.success&&p({title:x.success}),x!=null&&x.error&&p({variant:"destructive",title:x.error}),u.user.approvers&&Z(u.user.approvers.filter(t=>t.type=="po")[0])},[x]),j.useEffect(()=>{const t=i.reduce((a,f)=>a+(f.total_value||0),0);m(a=>({...a,total_po_value:t,attachment:D}))},[i,D]),j.useEffect(()=>{P.hasOwnProperty("error")&&p({variant:"destructive",description:P.error})},[P]);const ie=async t=>{try{I(void 0);const a=await window.axios.get(route("po.vendor",t));I(a.data.data)}catch(a){console.log("Error fetching vendor info: ",a)}},ne=()=>{var g,o,M,B,L;const t=new Date;let a=!0;const f=i.filter(n=>n.mat_code!==void 0).map((n,ae)=>({...n,item_no:(ae+1)*10}));if(S(f),f.length<=0)return p({variant:"destructive",description:"Please add atleast 1 item"}),!1;for(let n=0;n<i.length;n++)if(i[n].mat_code!==void 0&&i[n].mat_code!==""){if(i[n].po_qty===void 0||((g=i[n])==null?void 0:g.po_qty)<=0){p({variant:"destructive",description:`Please enter quantity for item no ${i[n].item_no}`}),a=!1;break}if(i[n].unit===void 0||((o=i[n])==null?void 0:o.unit)===null){p({variant:"destructive",description:`Please enter order unit for item no ${i[n].item_no}`}),a=!1;break}if(i[n].net_price===void 0||((M=i[n])==null?void 0:M.net_price)===null){p({variant:"destructive",description:`Please enter Net Price for item no ${i[n].item_no}`}),a=!1;break}if(i[n].del_date===void 0||((B=i[n])==null?void 0:B.del_date)===null){p({variant:"destructive",description:`Please enter delivery date for item no ${i[n].item_no}`}),a=!1;break}else if(((L=i[n].del_date)==null?void 0:L.getTime())<=t.getTime()){p({variant:"destructive",description:`Please enter delivery date greater than today for item no ${i[n].item_no}`}),a=!1;break}}return a},le=async t=>{t.preventDefault(),ne()&&J(route("po.update",r.id),{preserveScroll:!0,onSuccess:a=>{K(),H([])}})};return e.jsxs(ce,{user:u.user,menus:u.menu,header:e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Edit Purchase Order"}),r.status==T&&e.jsx("a",{className:"text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 shadow-lg shadow-green-500/50 dark:shadow-lg dark:shadow-green-800/80 font-medium rounded-lg text-sm p-1 text-center",href:route("po.print",r.id),target:"_blank",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0 1 10.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0 .229 2.523a1.125 1.125 0 0 1-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0 0 21 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 0 0-1.913-.247M6.34 18H5.25A2.25 2.25 0 0 1 3 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 0 1 1.913-.247m10.5 0a48.536 48.536 0 0 0-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5Zm-3 0h.008v.008H15V10.5Z"})})})]}),children:[e.jsx(de,{title:"PO Create"}),e.jsx(je,{}),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-2",children:e.jsxs("div",{className:"bg-gray-50 overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsxs("form",{onSubmit:le,children:[e.jsxs("div",{className:"p-5 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(b,{htmlFor:"prnumber",children:"PO Number"}),e.jsx(y,{type:"text",id:"prnumber",defaultValue:l.po_number,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(b,{htmlFor:"control_no",children:"Control No."}),e.jsx(y,{type:"text",id:"control_no",defaultValue:l.control_no,onChange:t=>m("control_no",t.target.value)})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(b,{htmlFor:"created_by",children:"Created By"}),e.jsx(y,{type:"text",id:"created_by",defaultValue:l.created_name,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(b,{htmlFor:"date",children:"Doc Date"}),e.jsx(y,{type:"text",id:"date",defaultValue:l.doc_date,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(b,{htmlFor:"date",children:"Delivery Date"}),e.jsx(y,{type:"date",id:"deliv_date",defaultValue:l.deliv_date,onChange:t=>m("deliv_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"flex-none w-96",children:[e.jsx(b,{children:"Vendor"}),e.jsx(ye,{value:(N==null?void 0:N.find(({value:t})=>t===l.vendor_id))??null,options:N,onChange:({value:t})=>{m("vendor_id",t),ie(t)},styles:{control:(t,a)=>({...t,minHeight:"1.75rem",height:"1.75rem",fontSize:"0.875rem",borderColor:"hsl(var(--input))"}),valueContainer:(t,a)=>({...t,height:"1.75rem",padding:"0 6px"}),input:(t,a)=>({...t,margin:"0px"}),indicatorSeparator:t=>({display:"none"}),indicatorsContainer:(t,a)=>({...t,height:"1.75rem"})}})]}),e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(b,{children:"Requesting Plant"}),e.jsxs(V,{defaultValue:l.plant,onValueChange:t=>m("plant",t),children:[e.jsx(A,{children:e.jsx(q,{placeholder:"Plant"})}),e.jsx(W,{children:u.user.plants&&u.user.plants.map(t=>e.jsxs(E,{value:t.plant,children:[t.plant," ",t.name1]},t.plant))})]})]})]}),e.jsx("div",{className:"p-1 pt-0",children:e.jsxs(U,{defaultValue:"header_text",className:"max-w-8xl",children:[e.jsxs($,{children:[e.jsx(_,{value:"header_text",children:"Header Text"}),e.jsx(_,{value:"approver_text",children:"Remarks"}),e.jsx(_,{value:"notes",children:"Notes"}),e.jsx(_,{value:"deliv_addr",children:"Delivery Address"}),e.jsx(_,{value:"workflow",children:"Workflow"}),e.jsx(_,{value:"attachment",children:"Attachment"}),e.jsx(_,{value:"vendor",children:"Vendor Info"})]}),e.jsx(v,{value:"header_text",children:e.jsx(z,{value:l.header_text,onChange:t=>m("header_text",t.target.value)})}),e.jsx(v,{value:"notes",children:e.jsxs(V,{defaultValue:l.notes,onValueChange:t=>m("notes",t),children:[e.jsx(A,{children:e.jsx(q,{placeholder:"Notes"})}),e.jsx(W,{children:me.map(t=>e.jsx(E,{value:t,children:t},t))})]})}),e.jsx(v,{value:"approver_text",children:e.jsx(z,{value:l.approver_text,onChange:t=>m("approver_text",t.target.value)})}),e.jsx(v,{value:"deliv_addr",children:e.jsxs(V,{defaultValue:l.deliv_addr,onValueChange:t=>m("deliv_addr",t),children:[e.jsx(A,{children:e.jsx(q,{placeholder:"Address"})}),e.jsx(W,{children:xe.map(t=>e.jsx(E,{value:t,children:t},t))})]})}),e.jsx(v,{value:"workflow",children:e.jsxs(Q,{className:"w-11/2 text-xs",children:[e.jsx(pe,{children:e.jsxs(C,{className:"font-bold p-0",children:[e.jsx(w,{children:"Position"}),e.jsx(w,{children:"Status"}),e.jsx(w,{children:"Approved By"}),e.jsx(w,{children:"Approved Date"}),e.jsx(w,{children:"Remarks"})]})}),e.jsx(G,{children:r.workflows&&r.workflows.map(t=>e.jsxs(C,{children:[e.jsx(c,{children:t.position}),e.jsxs(c,{children:[t.status," "]}),e.jsxs(c,{children:[" ",t.approved_by," "]}),e.jsxs(c,{children:[t.approved_date," "]}),e.jsxs(c,{children:[t.message," "]})]},t.id))})]})}),e.jsxs(v,{value:"attachment",children:[e.jsx("ul",{className:"mt-3 mb-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4  gap-5 ",children:r.attachments&&r.attachments.map(t=>e.jsxs("li",{className:"relative h-12 rounded-md shadow-lg p-2 bg-white",children:[u.permissions.po.edit&&e.jsx(k,{preserveScroll:!0,href:route("attachment.delete",t.id),method:"delete",as:"button",className:"w-7 h-7  bg-slate-100 rounded-full flex justify-center items-center absolute top-3 right-2 hover:bg-red-200 transition-colors",children:e.jsx(_e,{className:"w-6 h-6  text-red-600 hover:fill-red-700 transition-colors"})}),e.jsx("p",{className:"mt-2 text-blue-600 text-sm font-medium truncate pr-7",children:e.jsx("a",{href:"/"+t.filepath,download:!0,children:t.filename})})]},t.filename))}),e.jsx(ve,{files:D,setFiles:H})]}),e.jsx(v,{value:"vendor",children:e.jsx(we,{children:e.jsx(Ne,{children:d&&e.jsx("div",{children:e.jsx(Q,{className:"w-11/2 text-xs",children:e.jsxs(G,{children:[e.jsxs(C,{className:"border-none h-",children:[e.jsx(c,{children:e.jsx("b",{children:"Account group: "})}),e.jsx(c,{children:d.account_group}),e.jsx(c,{children:e.jsx("b",{children:"Name : "})}),e.jsxs(c,{children:[" ",d.name_1," ",d.name_2," ",d.name_3," ",d.name_4]}),e.jsx(c,{children:e.jsx("b",{children:"Supplier : "})}),e.jsx(c,{children:d.supplier})]},d.id),e.jsxs(C,{className:"border-none",children:[e.jsx(c,{children:e.jsx("b",{children:"Address : "})}),e.jsxs(c,{children:[d.street," ",d.district," ",d.city," ",d.postal_code," ",d.country]}),e.jsx(c,{children:e.jsx("b",{children:"Tax Number : "})}),e.jsxs(c,{children:[d.tax_number," ",d.tax_number_2]})]},d.id),e.jsxs(C,{className:"border-none",children:[e.jsx(c,{children:e.jsx("b",{children:"Telephone 1 : "})}),e.jsx(c,{children:d.telephone_1}),e.jsx(c,{children:e.jsx("b",{children:"Telephone 2 : "})}),e.jsx(c,{children:d.telephone_2})]},d.id)]})})})})})})]})}),e.jsx("div",{className:"p-2",children:e.jsx(s.DataSheetGrid,{value:i,onChange:se,columns:ee,style:te,disableExpandSelection:!0,rowHeight:30,className:"text-sm"})}),e.jsxs("div",{className:"p-1 flex gap-2 justify-end content-center",children:[e.jsx("div",{className:"p-1",children:e.jsx(b,{htmlFor:"total",children:"Total PO Value: "})}),e.jsx("div",{children:e.jsx(y,{id:"total",type:"text",value:ge(l.total_po_value),readOnly:!0,disabled:!0})})]}),e.jsxs("div",{className:"p-2 pt-0",children:[e.jsxs(U,{defaultValue:"itemDetails",className:"max-w-xl",children:[e.jsx($,{children:e.jsx(_,{value:"action",children:"Action"})}),e.jsx(v,{value:"action",children:u.permissions.po.edit&&e.jsxs(e.Fragment,{children:[e.jsx(k,{preserveScroll:!0,href:route("po.update-controlno"),data:{id:r.id,control_no:l.control_no},as:"button",type:"button",className:"p-2 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-100 ",children:"Update Control No."}),e.jsx(Y,{p_description:"Are you sure you want to flag delete this item(s)?",p_title:"Flag for Delete",p_url:route("po.flag.delete"),p_disable:i.filter(t=>t.sel==!0).length==0,p_items:{ids:i.filter(t=>t.sel==!0).map(t=>t.id)}}),e.jsx(Y,{p_description:"Are you sure you want to flag delivered this item(s)?",p_title:"Flag Delivered",p_url:route("po.flag.deliver"),p_disable:i.filter(t=>t.sel==!0).length==0,p_items:{ids:i.filter(t=>t.sel==!0).map(t=>t.id)}})]})})]}),e.jsx("div",{className:"p-5 justify-end grid grid-cols-8 gap-4",children:u.permissions.po.edit&&e.jsxs(e.Fragment,{children:[e.jsx(ue,{variant:"outline",className:"bg-[#f8c110]  hover:border-gray-500 hover:bg-[#f8c110] disabled:cursor-not-allowed disabled:opacity-100 disabled:bg-gray-100",disabled:X,children:"Save"}),e.jsx(k,{href:route("po.index"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-100",children:"Cancel"}),e.jsx(k,{disabled:r.appr_seq!=he,preserveScroll:!0,href:route("po.submit",r.id),as:"button",type:"button",className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none border border-input bg-[#f8c110] hover:bg-[#f8c110] hover:text-accent-foreground hover:border-gray-500
                        disabled:cursor-not-allowed disabled:opacity-100 disabled:bg-gray-100 `,children:"Submit"}),e.jsx(Ce,{p_id:r.id,p_title:"Discard this Purchase Order ?",p_url:"po.discard"}),e.jsx(fe,{p_vendor:l.vendor_id,p_plant:l.plant,p_created_name:l.created_name,p_doc_date:l.doc_date,addToPO:re})]})})]})]}),u.permissions.po.approver&&e.jsxs("div",{className:"px-5 pb-5",children:[e.jsx(O,{p_po_number:l.po_number,p_type:"approved",p_title:"approve",p_disable:r.status==T||r.status==F||r.status==R||(h==null?void 0:h.seq)!=r.appr_seq}),e.jsx(O,{p_po_number:l.po_number,p_type:"rework",p_title:"rework",p_disable:r.status==T||r.status==F||r.status==R||(h==null?void 0:h.seq)!=r.appr_seq}),e.jsx(O,{p_po_number:l.po_number,p_type:"rejected",p_title:"reject",p_disable:r.status==T||r.status==F||r.status==R||(h==null?void 0:h.seq)!=r.appr_seq})]})]})})})]})};export{et as default};
