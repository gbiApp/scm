import{r as g,W as Q,j as e,Y,a as z}from"./app-CCoq69JG.js";import{A as J}from"./AuthenticatedLayout-Chu80k62.js";import{T as I,a as A,b as x,c as h}from"./tabs-BfRMKEeW.js";import{B as K}from"./button-DoBpF-57.js";import{T as y}from"./textarea-CVVndhl6.js";import{L as p,I as v}from"./input-BDfD828S.js";import{S as C,a as N,b as T,c as k,d as w}from"./select-BnowPioC.js";import{S as X}from"./react-select.esm-CsbqgSHr.js";/* empty css              */import Z from"./AddPrtoPo-NaKMn_IV.js";import{N as ee,D as te,T as re,a as ae,b as S,c as d}from"./constants-CTD3bcQS.js";import{d as r}from"./index-DM7iccms.js";import{u as ne,T as le}from"./toaster-BtcZbz9G.js";import{f as ie}from"./utils-B3WcY1H0.js";import{C as oe,a as se}from"./card-fx-cI9zc.js";import"./ApplicationLogo-DO-c5t_j.js";import"./transition-BIm4Rmlc.js";import"./x-jtu1iq5W.js";import"./index-D6YLH5uR.js";import"./index-Bm6ONju_.js";import"./Combination-C1ERZ9na.js";const We=({auth:u,vendors:f})=>{var P;const E=new Date().toLocaleDateString(),{toast:_}=ne(),[n,b]=g.useState([]),[o,q]=g.useState(),{data:s,setData:c,post:R,errors:de,reset:ce,processing:F}=Q({id:0,po_number:void 0,control_no:void 0,vendor_id:void 0,vendor_name:"",created_name:u.user.name,doc_date:E,deliv_date:void 0,notes:"",plant:u.user.plants!==void 0?(P=u.user.plants[0])==null?void 0:P.plant:"",header_text:"",approver_text:"",attachment:void 0,total_po_value:0,status:"",appr_seq:0,deliv_addr:"",pomaterials:[]}),O=[{...r.keyColumn("sel",r.checkboxColumn),title:"Sel",minWidth:30},{...r.keyColumn("status",r.textColumn),title:"Sts",minWidth:35,disabled:!0},{...r.keyColumn("item_no",r.intColumn),title:"ItmNo",minWidth:55,disabled:!0},{...r.keyColumn("mat_code",r.textColumn),title:"Material",minWidth:120,disabled:!0},{...r.keyColumn("short_text",r.textColumn),title:"Short Text",minWidth:300,disabled:!0},{...r.keyColumn("po_qty",r.floatColumn),title:"PO Qty",minWidth:70},{...r.keyColumn("qty_open",r.floatColumn),title:"Open Qty",minWidth:100,disabled:!0},{...r.keyColumn("unit",r.textColumn),title:"Unit",minWidth:55},{...r.keyColumn("net_price",r.floatColumn),title:"Net Price",minWidth:80,disabled:({rowData:t})=>!!t.item_free},{...r.keyColumn("per_unit",r.intColumn),title:"Per Unit",minWidth:50,disabled:({rowData:t})=>!!t.item_free},{...r.keyColumn("total_value",r.intColumn),title:"Total Value",minWidth:120,disabled:!0},{...r.keyColumn("item_free",r.checkboxColumn),title:"Free",minWidth:70},{...r.keyColumn("currency",r.textColumn),title:"Curr",minWidth:55,disabled:!0},{...r.keyColumn("del_date",r.dateColumn),title:"Del Date",minWidth:120},{...r.keyColumn("mat_grp",r.textColumn),title:"Mat Grp",minWidth:200,disabled:!0},{...r.keyColumn("requested_by",r.textColumn),title:"Requested By",minWidth:150},{...r.keyColumn("pr_number",r.textColumn),title:"PR Number",minWidth:120,disabled:!0},{...r.keyColumn("pr_item",r.textColumn),title:"PRItm",minWidth:70,disabled:!0},{...r.keyColumn("item_text",r.textColumn),title:"Item Text",minWidth:300}],M={"--dsg-header-text-color":"rgb(10, 10, 10)","--dsg-cell-disabled-background-color":"rgb(245, 245, 245)","--dsg-border-color":"#bfbdbd"},$=t=>{b([...n,...t])},B=(t,l)=>{const m=[...t];console.log("updatedMaterial",m);for(const j of l)if(j.type==="UPDATE"){const a=m[j.fromRowIndex];a.net_price=a.item_free?0:a.net_price,a.item_no=(j.fromRowIndex+1)*10,a.po_qty=a.po_qty<a.min_order_qty?a.min_order_qty:a.po_qty,a.po_qty=a.po_qty>a.qty_open?a.qty_open:a.po_qty,a.converted_qty=a.po_qty*(a.conversion/a.denominator),a.total_value=(a.net_price??0)/(a.per_unit??0)*(a.po_qty??0)}console.log("update",m),b(m),c({...s,pomaterials:m})};g.useEffect(()=>{const t=n.reduce((l,m)=>l+(m.total_value||0),0);c(l=>({...l,total_po_value:t}))},[n]);const L=async t=>{try{q(void 0);const l=await window.axios.get(route("po.vendor",t));q(l.data.data)}catch(l){console.log("Error fetching vendor info: ",l)}},H=()=>{var j,a,V,W,D;const t=new Date;let l=!0;const m=n.filter(i=>i.mat_code!==void 0).map((i,G)=>({...i,item_no:(G+1)*10}));if(b(m),console.log("item",m),m.length<=0)return _({variant:"destructive",description:"Please add atleast 1 item"}),!1;for(let i=0;i<n.length;i++)if(n[i].mat_code!==void 0&&n[i].mat_code!==""){if(n[i].po_qty===void 0||((j=n[i])==null?void 0:j.po_qty)<=0){_({variant:"destructive",description:`Please enter quantity for item no ${n[i].item_no}`}),l=!1;break}if(n[i].unit===void 0||((a=n[i])==null?void 0:a.unit)===null){_({variant:"destructive",description:`Please enter order unit for item no ${n[i].item_no}`}),l=!1;break}if(n[i].net_price===void 0||((V=n[i])==null?void 0:V.net_price)===null){_({variant:"destructive",description:`Please enter Net Price for item no ${n[i].item_no}`}),l=!1;break}if(n[i].del_date===void 0||((W=n[i])==null?void 0:W.del_date)===null){_({variant:"destructive",description:`Please enter delivery date for item no ${n[i].item_no}`}),l=!1;break}else if(((D=n[i].del_date)==null?void 0:D.getTime())<=t.getTime()){_({variant:"destructive",description:`Please enter delivery date greater than today for item no ${n[i].item_no}`}),l=!1;break}}return l},U=async t=>{t.preventDefault(),H()&&(console.log(s),R(route("po.store")))};return e.jsxs(J,{user:u.user,menus:u.menu,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Create Purchase Order"}),children:[e.jsx(Y,{title:"PO Create"}),e.jsx(le,{}),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-2",children:e.jsx("div",{className:"bg-gray-50 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"p-5 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(p,{htmlFor:"prnumber",children:"PO Number"}),e.jsx(v,{type:"text",id:"prnumber",defaultValue:s.po_number,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(p,{htmlFor:"control_no",children:"Control No."}),e.jsx(v,{type:"number",id:"control_no",defaultValue:s.control_no,onChange:t=>c("control_no",t.target.value)})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(p,{htmlFor:"created_by",children:"Created By"}),e.jsx(v,{type:"text",id:"control_no",defaultValue:s.created_name,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(p,{htmlFor:"date",children:"Doc Date"}),e.jsx(v,{type:"text",id:"date",defaultValue:s.doc_date,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(p,{htmlFor:"date",children:"Delivery Date"}),e.jsx(v,{type:"date",id:"deliv_date",defaultValue:s.deliv_date,onChange:t=>c("deliv_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"flex-none w-96",children:[e.jsx(p,{children:"Vendor"}),e.jsx(X,{required:!0,value:(f==null?void 0:f.find(({value:t})=>t===s.vendor_id))??null,options:f,onChange:({value:t,label:l})=>{c({...s,vendor_id:t,vendor_name:l}),L(t)},styles:{control:(t,l)=>({...t,minHeight:"1.75rem",height:"1.75rem",fontSize:"0.875rem",borderColor:"hsl(var(--input))"}),valueContainer:(t,l)=>({...t,height:"1.75rem",padding:"0 6px"}),input:(t,l)=>({...t,margin:"0px"}),indicatorSeparator:t=>({display:"none"}),indicatorsContainer:(t,l)=>({...t,height:"1.75rem"})}})]}),e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(p,{htmlFor:"requestingPlant",children:"Requesting Plant"}),e.jsxs(C,{defaultValue:s.plant,onValueChange:t=>c("plant",t),children:[e.jsx(N,{children:e.jsx(T,{placeholder:"Plant"})}),e.jsx(k,{children:u.user.plants&&u.user.plants.map(t=>e.jsxs(w,{value:t.plant,children:[t.plant," ",t.name1]},t.plant))})]})]})]}),e.jsx("div",{className:"p-1 pt-0",children:e.jsxs(I,{defaultValue:"header_text",className:"max-w-8xl",children:[e.jsxs(A,{children:[e.jsx(x,{value:"header_text",children:"Header Text"}),e.jsx(x,{value:"approver_text",children:"Approver Text"}),e.jsx(x,{value:"notes",children:"Notes"}),e.jsx(x,{value:"deliveryAddress",children:"Delivery Address"}),e.jsx(x,{value:"workflow",children:"Workflow"}),e.jsx(x,{value:"attachment",children:"Attachment"}),e.jsx(x,{value:"vendor",children:"Vendor Info"})]}),e.jsx(h,{value:"header_text",children:e.jsx(y,{value:s.header_text,onChange:t=>c("header_text",t.target.value)})}),e.jsx(h,{value:"notes",children:e.jsxs(C,{defaultValue:s.notes,onValueChange:t=>c("notes",t),children:[e.jsx(N,{children:e.jsx(T,{placeholder:"Notes"})}),e.jsx(k,{children:ee.map(t=>e.jsx(w,{value:t,children:t},t))})]})}),e.jsx(h,{value:"deliveryAddress",children:e.jsxs(C,{defaultValue:s.deliv_addr,onValueChange:t=>c("deliv_addr",t),children:[e.jsx(N,{children:e.jsx(T,{placeholder:"Address"})}),e.jsx(k,{children:te.map(t=>e.jsx(w,{value:t,children:t},t))})]})}),e.jsx(h,{value:"approver_text",children:e.jsx(y,{value:s.approver_text,onChange:t=>c("approver_text",t.target.value)})}),e.jsx(h,{value:"workflow"}),e.jsx(h,{value:"attachment",children:e.jsx(v,{type:"file",className:"min-h-10",multiple:!0,onChange:t=>c("attachment",t.target.files||void 0)})}),e.jsx(h,{value:"vendor",children:e.jsx(oe,{children:e.jsx(se,{children:o&&e.jsx("div",{children:e.jsx(re,{className:"w-11/2 text-sm",children:e.jsxs(ae,{children:[e.jsxs(S,{className:"border-none h-",children:[e.jsx(d,{children:e.jsx("b",{children:"Account group: "})}),e.jsx(d,{children:o.account_group}),e.jsx(d,{children:e.jsx("b",{children:"Name : "})}),e.jsxs(d,{children:[" ",o.name_1," ",o.name_2," ",o.name_3," ",o.name_4]}),e.jsx(d,{children:e.jsx("b",{children:"Supplier : "})}),e.jsx(d,{children:o.supplier})]},o.id),e.jsxs(S,{className:"border-none",children:[e.jsx(d,{children:e.jsx("b",{children:"Address : "})}),e.jsxs(d,{children:[o.street," ",o.district," ",o.city," ",o.postal_code," ",o.country]}),e.jsx(d,{children:e.jsx("b",{children:"Tax Number : "})}),e.jsxs(d,{children:[o.tax_number," ",o.tax_number_2]})]},o.id),e.jsxs(S,{className:"border-none",children:[e.jsx(d,{children:e.jsx("b",{children:"Telephone 1 : "})}),e.jsx(d,{children:o.telephone_1}),e.jsx(d,{children:e.jsx("b",{children:"Telephone 2 : "})}),e.jsx(d,{children:o.telephone_2})]},o.id)]})})})})})})]})}),e.jsx("div",{className:"p-2",children:e.jsx(r.DataSheetGrid,{value:n,onChange:B,columns:O,style:M,disableExpandSelection:!0,rowHeight:30,className:"text-sm"})}),e.jsxs("div",{className:"p-1 flex gap-2 justify-end content-center",children:[e.jsx("div",{className:"p-1",children:e.jsx(p,{htmlFor:"total",children:"Total PO Value: "})}),e.jsx("div",{children:e.jsx(v,{type:"text",value:ie(s.total_po_value),readOnly:!0,disabled:!0})})]}),e.jsxs("div",{className:"p-2 pt-0",children:[e.jsxs(I,{defaultValue:"ItemText",className:"max-w-xl",children:[e.jsx(A,{children:e.jsx(x,{value:"ItemText",children:"Item Text"})}),e.jsx(h,{value:"ItemText",children:e.jsx(y,{})})]}),e.jsx("div",{className:"p-5 justify-end grid grid-cols-8 gap-4",children:u.permissions.po.create&&e.jsxs(e.Fragment,{children:[e.jsx(K,{variant:"outline",disabled:F,className:"bg-[#f8c110]  hover:border-gray-500 hover:bg-[#f8c110]",children:"Save"}),e.jsx(z,{href:route("po.index"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-500",children:"Cancel"}),e.jsx(Z,{p_vendor:s.vendor_id,p_plant:s.plant,p_created_name:s.created_name,p_doc_date:s.doc_date,addToPO:$})]})})]})]})})})})]})};export{We as default};
