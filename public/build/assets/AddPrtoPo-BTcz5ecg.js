import{r as y,j as e}from"./app-9BfIP8Yt.js";import{D as w,d as C,e as D,f as M,g as O,h as S,I,i as k,j as v}from"./InputField-BbCt2qk6.js";import"./tabs-CSAEFCKf.js";import{B as q}from"./button-UluEiDe7.js";import"./textarea-WPr4wz2o.js";import"./input-B6LatCgn.js";import"./toast-SiKyGAR4.js";import"./select-BlE8HqPq.js";import{f as P}from"./utils-BSdE8tDE.js";import"./constants-Co51-129.js";function R(){const f=(o,d,m="")=>{var g;const _=d;let l=d,a=o.qty_open,r=o.per_unit,i=0,p=0,x=0,j=0,h=1,t=o.po_qty??o.qty_open;const s=o.materialNetPrices.find(u=>u.uom===l&&u.vendor===m),c=o.materialNetPrices.find(u=>u.uom===l),n=(g=o.alt_uom)==null?void 0:g.find(u=>u.alt_uom===l);return h=((n==null?void 0:n.counter)??1)/((n==null?void 0:n.denominator)??1),j=(t??0)*h,a=(o.qty_open??0)*(o.conversion??0),a=a/h,s?(i=s.price,x=s.min_order_qty,p=(i??0)/(r??0)*(t??0)):c?(i=c.price,x=c.min_order_qty,p=(i??0)/(r??0)*(t??0)):(i=o.net_price??o.price,p=(i??0)/(r??0)*(t??0)),{conversion_po:h,ord_unit:_,net_price:i,converted_qty_po:j,total_value:p,min_order_qty:x,qty_open_po:a,unit:l,po_qty:t}};return{computeConversion:f,updateMaterialPO:(o,d,m=!1)=>{const _=[...o];for(const l of d)if(l.type==="UPDATE")for(let a=l.fromRowIndex;a<l.toRowIndex;a++){const r=_[a],{converted_qty_po:i,total_value:p}=f(r,r.unit??"");if(r.net_price=r.item_free?0:r.net_price,r.item_no=(l.fromRowIndex+1)*10,r.po_qty=r.po_qty<r.min_order_qty?r.min_order_qty:r.po_qty,m){const x=r.qty_open_po+r.origPOQty;r.po_qty=r.po_qty>x?x:r.po_qty}else r.po_qty=r.po_qty>r.qty_open_po?r.qty_open_po:r.po_qty;r.converted_qty_po=i,r.total_value=p}return _},getVendorInfo:async o=>{try{return(await window.axios.get(route("po.vendor",o))).data.data}catch(d){console.log("Error fetching vendor info: ",d);return}}}}const A={pr_number:"PR Number",mat_code:"Material",short_text:"Short Text",mat_grp:"Material Group",del_date:"Delivery Date",purch_grp:"Buyer Group"};function L({p_plant:f,p_doc_date:N,addToPO:b}){const[o,d]=y.useState([]),[m,_]=y.useState([]),{computeConversion:l}=R(),[a,r]=y.useState({pr_number:"",mat_code:"",short_text:"",del_date:"",mat_grp:"",purch_grp:""}),i=y.useCallback(async()=>{try{const t=await window.axios.get(route("po.plant"),{params:{plant:f,doc_date:N}});_(t.data.data)}catch(t){console.error("Error fetching material info:",t)}},[f,N]),p=y.useCallback((t,s)=>{d(c=>t.target.checked?[...c,s]:c.filter(n=>n.id!==s.id))},[]),x=()=>{const t=o==null?void 0:o.map(s=>{var n,g;const c=[...new Set([s.ord_unit,...(n=s==null?void 0:s.alt_uom)==null?void 0:n.map(u=>u.alt_uom)])];return{...s,...l(s,s.ord_unit??""),del_date:new Date(s.del_date||""),pr_material_id:s.id,pr_item:s.item_no,pr_unit:s.unit,altUomSelect:c,mat_grp_desc:((g=s.materialGroups)==null?void 0:g.mat_grp_desc)||"",item_no:void 0}});b(t),d([])},j=t=>{const{id:s,value:c}=t.target;r({...a,[s]:c})},h=y.useMemo(()=>m.filter(t=>Object.entries(a).every(([s,c])=>{var n;return c===""||(((n=t[s])==null?void 0:n.toLowerCase())||"").includes(c.toLowerCase())})),[m,a]);return e.jsxs(w,{children:[e.jsx(C,{onClick:i,className:"bg-blue-400 hover:bg-blue-500 hover:text-accent-foreground hover:border-gray-500 border border-input bg-background hover:bg-accent inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:"Add PR to PO"}),e.jsxs(D,{className:"min-w-full sm:max-w-md",children:[e.jsx(M,{children:e.jsx(O,{children:"PR Selection"})}),e.jsxs(S,{children:[e.jsx("div",{className:"flex items-center space-x-2 w-full",children:e.jsx("div",{className:"p-2 flex flex-wrap gap-4",children:Object.keys(a).map(t=>e.jsx(I,{label:A[t],id:t,value:a[t],onChange:j},t))})}),e.jsx("div",{className:"overflow-y-auto h-96",children:e.jsxs("table",{className:" table-auto w-full text-sm text-left rtl:text-right text-gray-500 ",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50  border-gray-500 sticky top-0",children:e.jsxs("tr",{className:"text-nowrap ",children:[e.jsx("th",{className:"px-3 py-1",children:" Sel"}),e.jsx("th",{className:"px-3 py-1",children:" Pr"}),e.jsx("th",{className:"px-3 py-1",children:" Material"}),e.jsx("th",{className:"px-3 py-1",children:" Short"}),e.jsx("th",{className:"px-3 py-1",children:" Open Qty"}),e.jsx("th",{className:"px-3 py-1",children:" Unit"}),e.jsx("th",{className:"px-3 py-1",children:" Per"}),e.jsx("th",{className:"px-3 py-1",children:" Price"}),e.jsx("th",{className:"px-3 py-1",children:" Total Value"}),e.jsx("th",{className:"px-3 py-1",children:" Curr"}),e.jsx("th",{className:"px-3 py-1",children:" Del Date"}),e.jsx("th",{className:"px-3 py-1",children:" MatGrp"}),e.jsx("th",{className:"px-3 py-1",children:" Buyer Grp"}),e.jsx("th",{className:"px-3 py-1",children:" Requested"})]})}),e.jsx("tbody",{className:"text-sm",children:h.length>0?h.map(t=>e.jsxs("tr",{className:"bg-white border-b",children:[e.jsx("td",{className:"px-3 py-1",children:e.jsx("input",{type:"checkbox",name:"sel",onClick:()=>p(event,t)})}),e.jsx("td",{className:"px-3 py-1",children:t.pr_number}),e.jsx("td",{className:"px-3 py-1",children:t.mat_code}),e.jsx("td",{className:"px-3 py-1",children:t.short_text}),e.jsx("td",{className:"px-3 py-1",children:t.qty_open}),e.jsx("td",{className:"px-3 py-1",children:t.ord_unit}),e.jsx("td",{className:"px-3 py-1",children:t.per_unit}),e.jsx("td",{className:"px-3 py-1 text-right",children:P(t.price??0)}),e.jsx("td",{className:"px-3 py-1 text-right",children:P(t.total_value??0)}),e.jsx("td",{className:"px-3 py-1",children:t.currency}),e.jsx("td",{className:"px-3 py-1",children:t.del_date??""}),e.jsx("td",{className:"px-3 py-1",children:t.mat_grp}),e.jsx("td",{className:"px-3 py-1",children:t.purch_grp}),e.jsx("td",{className:"px-3 py-1",children:t.requested_by})]},t.id)):e.jsx("td",{className:"px-3 py-1 text-center",colSpan:14,children:"No Records Found"})})]})})]}),e.jsxs(k,{className:"sm:justify-start",children:[e.jsx(v,{asChild:!0,children:e.jsx(q,{type:"button",variant:"secondary",children:"Close"})}),e.jsx(v,{asChild:!0,children:e.jsx(q,{type:"button",onClick:x,children:"Add to PO"})})]})]})]})}const W=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));export{L as A,W as a,R as u};
