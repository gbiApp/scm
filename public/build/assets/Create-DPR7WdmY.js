import{r as F,W as O,j as e,Y as Q,a as Y}from"./app-CCoq69JG.js";import{A as z}from"./AuthenticatedLayout-Chu80k62.js";import{T as J,a as K,b,c as j}from"./tabs-BfRMKEeW.js";import{B as X}from"./button-DoBpF-57.js";import{T as R}from"./textarea-CVVndhl6.js";import{L as m,I as p}from"./input-BDfD828S.js";import{S as Z,a as ee,b as te,c as ae,d as re}from"./select-BnowPioC.js";/* empty css              */import{s as V}from"./SelectComponent-CWpHOdr6.js";import{d as a}from"./index-DM7iccms.js";import{u as oe,T as ie}from"./toaster-BtcZbz9G.js";import{f as se}from"./utils-B3WcY1H0.js";import"./ApplicationLogo-DO-c5t_j.js";import"./transition-BIm4Rmlc.js";import"./x-jtu1iq5W.js";import"./index-D6YLH5uR.js";import"./index-Bm6ONju_.js";import"./Combination-C1ERZ9na.js";import"./react-select.esm-CsbqgSHr.js";const Te=({auth:n,mat_code:D,mat_desc:I})=>{var w;const G=new Date().toLocaleDateString(),{toast:v}=oe(),[i,q]=F.useState([{sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,total_value:void 0,currency:void 0,del_date:void 0,mat_grp:void 0,purch_grp:void 0},{sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,total_value:void 0,currency:void 0,del_date:void 0,mat_grp:void 0,purch_grp:void 0},{sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,currency:void 0,total_value:void 0,del_date:void 0,mat_grp:void 0,purch_grp:void 0}]),{data:d,setData:c,post:M,errors:le,reset:de,processing:E}=O({id:0,pr_number:"",created_name:n.user.name,doc_date:G,requested_by:n.user.name,plant:n.user.plants!==void 0?(w=n.user.plants[0])==null?void 0:w.plant:"",reason_pr:"",header_text:"",attachment:void 0,total_pr_value:0,status:"",deliv_addr:"",prmaterials:[]}),U=[{...a.keyColumn("sel",a.checkboxColumn),title:"Sel",minWidth:30},{...a.keyColumn("status",a.textColumn),title:"Sts",disabled:!0,minWidth:35},{...a.keyColumn("item_no",a.intColumn),title:"ItmNo",disabled:!0,minWidth:55},{...a.keyColumn("mat_code",V({choices:D})),title:"Material",minWidth:120},{...a.keyColumn("short_text",V({choices:I})),title:"Short Text",minWidth:300},{...a.keyColumn("qty",a.floatColumn),title:"Qty",minWidth:70},{...a.keyColumn("ord_unit",a.textColumn),title:"Ord Unit",minWidth:55},{...a.keyColumn("price",a.floatColumn),title:"Price",minWidth:70,disabled:!0},{...a.keyColumn("per_unit",a.floatColumn),title:"Per Unit",minWidth:30,disabled:!0},{...a.keyColumn("unit",a.textColumn),title:"Unit",minWidth:40,disabled:!0},{...a.keyColumn("total_value",a.floatColumn),title:"Total Value",minWidth:90,disabled:!0},{...a.keyColumn("currency",a.textColumn),title:"Curr",minWidth:50,disabled:!0},{...a.keyColumn("del_date",a.dateColumn),title:"Del Date",minWidth:130},{...a.keyColumn("mat_grp",a.textColumn),title:"Mat Grp",minWidth:150,disabled:!0},{...a.keyColumn("purch_grp",a.textColumn),title:"Purch Grp",minWidth:150,disabled:!0}],A={"--dsg-header-text-color":"rgb(10, 10, 10)","--dsg-cell-disabled-background-color":"rgb(245, 245, 245)","--dsg-border-color":"#bfbdbd"},k=async r=>{try{return(await window.axios.get(route("material.details"),{params:{material:r,plant:d.plant}})).data.data}catch(l){return console.error("Error fetching material info:",l),null}},B=async(r,l)=>{var _,h,x,o,g,N,T,P,S,W;const u=[...r],f=[...i];for(const y of l)if(y.type==="UPDATE"){const t=u[y.fromRowIndex],C=f[y.fromRowIndex];if(t.mat_code&&t.mat_code!==C.mat_code){const s=await k(t.mat_code);s&&(t.short_text=s.mat_desc,t.ord_unit=s.base_uom,t.unit=s.base_uom,t.price=parseFloat(((_=s.valuations[0])==null?void 0:_.valuation_price)||0),t.currency=((h=s.valuations[0])==null?void 0:h.currency)||"",t.per_unit=parseFloat(((x=s.valuations[0])==null?void 0:x.per_unit)||0),t.mat_grp=((o=s.materialGroups[0])==null?void 0:o.mat_grp_code)||"",t.purch_grp=((g=s.purchasingGroups[0])==null?void 0:g.purch_grp)||"",t.total_value=t.price*(t.qty||0))}if(t.short_text&&t.short_text!==C.short_text){const s=await k(t.short_text);s&&(t.altUom=s.altUoms.map(H=>H.alt_uom),t.mat_code=s.mat_code,t.ord_unit=s.base_uom,t.unit=s.base_uom,t.price=parseFloat(((N=s.valuations[0])==null?void 0:N.valuation_price)||0),t.currency=((T=s.valuations[0])==null?void 0:T.currency)||"",t.per_unit=parseFloat(((P=s.valuations[0])==null?void 0:P.per_unit)||0),t.mat_grp=((S=s.materialGroups[0])==null?void 0:S.mat_grp_code)||"",t.purch_grp=((W=s.purchasingGroups[0])==null?void 0:W.purch_grp)||"",t.total_value=t.price*(t.qty||0))}t.qty!==C.qty&&(t.total_value=(t.price??0)/(t.per_unit??0)*(t.qty??0)),t.item_no=(y.fromRowIndex+1)*10}q(u),c({...d,prmaterials:u})},L=async r=>{r.preventDefault(),$()&&(console.log(d),M(route("pr.store")))},$=()=>{var f,_,h,x;const r=new Date;let l=!0;const u=i.filter(o=>o.mat_code!==void 0).map((o,g)=>({...o,item_no:(g+1)*10}));if(q(u),u.length<=0)return v({variant:"destructive",description:"Please add atleast 1 item"}),!1;for(let o=0;o<i.length;o++)if(i[o].mat_code!==void 0&&i[o].mat_code!==""){if(i[o].qty===void 0||((f=i[o])==null?void 0:f.qty)<=0){v({variant:"destructive",description:`Please enter quantity for item no ${i[o].item_no}`}),l=!1;break}if(i[o].ord_unit===void 0||((_=i[o])==null?void 0:_.ord_unit)===null){v({variant:"destructive",description:`Please enter order unit for item no ${i[o].item_no}`}),l=!1;break}if(i[o].del_date===void 0||((h=i[o])==null?void 0:h.del_date)===null){v({variant:"destructive",description:`Please enter delivery date for item no ${i[o].item_no}`}),l=!1;break}else if(((x=i[o].del_date)==null?void 0:x.getTime())<=r.getTime()){v({variant:"destructive",description:`Please enter delivery date greater than today for item no ${i[o].item_no}`}),l=!1;break}}return l};return F.useEffect(()=>{console.log(i);const r=i.reduce((l,u)=>l+(u.total_value||0),0);c(l=>({...l,total_pr_value:r}))},[i]),e.jsxs(z,{user:n.user,menus:n.menu,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Create Purchase Requisition"}),children:[e.jsx(Q,{title:"PR Create"}),e.jsx(ie,{}),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-2",children:e.jsx("div",{className:"bg-gray-50 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"p-5 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-auto",children:[e.jsx(m,{htmlFor:"prnumber",children:"PR Number"}),e.jsx(p,{type:"text",id:"prnumber",defaultValue:d.pr_number,disabled:!0})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(m,{htmlFor:"createdby",children:"Created By"}),e.jsx(p,{type:"text",id:"createdby",defaultValue:d.created_name,disabled:!0})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(m,{htmlFor:"date",children:"Date"}),e.jsx(p,{type:"text",id:"date",defaultValue:d.doc_date,disabled:!0})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(m,{htmlFor:"requested_by",children:"Requested By"}),e.jsx(p,{type:"text",id:"requested_by",value:d.requested_by,required:!0,onChange:r=>c("requested_by",r.target.value)})]}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(m,{htmlFor:"requestingPlant",children:"Requesting Plant"}),e.jsxs(Z,{defaultValue:d.plant,onValueChange:r=>c("plant",r),children:[e.jsx(ee,{children:e.jsx(te,{placeholder:"Plant"})}),e.jsx(ae,{children:n.user.plants&&n.user.plants.map(r=>e.jsxs(re,{value:r.plant,children:[r.plant," ",r.name1]},r.plant))})]})]})]}),e.jsx("div",{className:"p-1 pt-0",children:e.jsxs(J,{defaultValue:"reasonForPr",className:"max-w-8xl",children:[e.jsxs(K,{children:[e.jsx(b,{value:"reasonForPr",children:"Reason for PR"}),e.jsx(b,{value:"headerText",children:"Header Text"}),e.jsx(b,{value:"workflow",children:"Workflow"}),e.jsx(b,{value:"attachment",children:"Attachment"})]}),e.jsx(j,{value:"reasonForPr",children:e.jsx(R,{value:d.reason_pr,onChange:r=>c("reason_pr",r.target.value),required:!0})}),e.jsx(j,{value:"headerText",children:e.jsx(R,{value:d.header_text,onChange:r=>c("header_text",r.target.value)})}),e.jsx(j,{value:"workflow"}),e.jsx(j,{value:"attachment",children:e.jsx(p,{type:"file",className:"min-h-10",multiple:!0,onChange:r=>c("attachment",r.target.files||void 0)})})]})}),e.jsx("div",{className:"p-2",children:e.jsx(a.DataSheetGrid,{createRow:()=>({sel:!1,item_no:void 0,status:void 0,mat_code:void 0,short_text:void 0,qty:void 0,ord_unit:void 0,qty_ordered:void 0,qty_open:void 0,price:void 0,per_unit:void 0,unit:void 0,total_value:void 0,currency:void 0,del_date:void 0,mat_grp:void 0}),value:i,onChange:B,columns:U,style:A,autoAddRow:!0,disableExpandSelection:!0,rowHeight:30,className:"text-sm"})}),e.jsxs("div",{className:"float-right -mt-12 mr-72  flex gap-2 justify-end content-center",children:[e.jsx("div",{className:"",children:e.jsx(m,{htmlFor:"total",children:"Total PR Value: "})}),e.jsx("div",{children:e.jsx(p,{type:"text",value:se(d.total_pr_value),readOnly:!0,disabled:!0})})]}),e.jsx("div",{className:"p-2 pt-0",children:e.jsx("div",{className:"p-5 justify-end grid grid-cols-8 gap-4",children:n.permissions.pr.create&&e.jsxs(e.Fragment,{children:[e.jsx(X,{variant:"outline",disabled:E,className:"bg-[#f8c110]  hover:border-gray-500 hover:bg-[#f8c110] ",children:"Save"}),e.jsx(Y,{href:route("pr.index"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2  border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-500",children:"Cancel"})]})})})]})})})})]})};export{Te as default};
