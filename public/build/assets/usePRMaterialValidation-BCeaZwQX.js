import{j as w,r as $}from"./app-9BfIP8Yt.js";import{u as E}from"./toaster-C-nH-nj2.js";function T(){return w.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-gray-200 bg-opacity-50 z-[1000]",children:w.jsx("div",{className:"animate-spin rounded-full h-20 w-20 border-t-4 border-blue-500 border-solid"})})}const x={};function U(){const[y,h]=$.useState(!1),p=async(e,s)=>{try{const{data:a}=await window.axios.get(route("material.details"),{params:{material:e,plant:s}});return a==null?void 0:a.data}catch(a){return console.error(`Error fetching material info for "${e}":`,a),null}},m=(e,s)=>{var r;const a=((r=e.alt_uom)==null?void 0:r.find(({alt_uom:i})=>i===s))||{},c=(a.counter??1)/(a.denominator??1),l=e.valuation_price*c,u=(e.qty??0)*c,_=(l??0)/(e.per_unit??0)*(e.qty??0);return{conversion:c,price:l,converted_qty:u,total_value:_,ord_unit:s}};return{getMaterialInfo:p,updateMaterialPR:async(e,s,a,c)=>{var u,_,d;const l=[...e];h(!0);for(const r of s)if(r.type==="UPDATE")for(let i=r.fromRowIndex;i<r.toRowIndex;i++){const t=l[i],g=a[i],M=async o=>(x[o]||(x[o]=await p(o,c)),x[o]);if(t.mat_code&&t.mat_code!==g.mat_code||t.short_text&&t.short_text!==g.short_text){const o=await M(t.short_text??t.mat_code);if(o){const{altUoms:P=[],valuations:v=[{}],materialGroups:f=[],purchasingGroups:b=[]}=o,q=o.order_uom||o.base_uom,j=[...new Set([q,...P.map(R=>R.alt_uom)])];Object.assign(t,{altUomSelect:j,alt_uom:P,mat_code:o.mat_code,short_text:o.mat_desc,ord_unit:q,unit:o.base_uom,valuation_price:parseFloat(((u=v[0])==null?void 0:u.valuation_price)||"0"),currency:((_=v[0])==null?void 0:_.currency)||"PHP",per_unit:parseFloat(((d=v[0])==null?void 0:d.per_unit)||"1"),mat_grp:(f==null?void 0:f.mat_grp_code)||"",mat_grp_desc:(f==null?void 0:f.mat_grp_desc)||"",purch_grp:(b==null?void 0:b.purch_grp)||"",qty_ordered:null})}}if(t.mat_code&&t.mat_code[0].toUpperCase()==="S"&&(t.unit=t.ord_unit),t.qty&&t.qty!==g.qty||t.price&&t.price>0)if(t.mat_code[0].toUpperCase()==="S"){const o={total_value:t.qty*(t.price/t.per_unit)||0,conversion:1,converted_qty:t.qty};Object.assign(t,{...o})}else Object.assign(t,{...m(t,t.ord_unit??"")});t.item_no=(i+1)*10}return h(!1),l},computeConversion:m,isLoading:y}}const C=()=>{const{toast:y}=E();return{validateMaterials:p=>{const m=new Date;let n=!0;const e=[],s=p.filter(a=>a.mat_code).map((a,c)=>({...a,item_no:(c+1)*10}));s.length===0&&(e.push("Please add at least one item"),n=!1);for(const a of s){const{mat_code:c,qty:l,ord_unit:u,unit:_,del_date:d,item_no:r,price:i,per_unit:t}=a;if(c){if(!l||l<=0){e.push(`Please enter quantity for item no ${r}`),n=!1;break}if(!i||i<=0){e.push(`Please enter price for item no ${r}`),n=!1;break}if(!t||t<=0){e.push(`Please enter per unit for item no ${r}`),n=!1;break}if(!u){e.push(`Please enter order unit for item no ${r}`),n=!1;break}if(d){if(new Date(d).getTime()<=m.getTime()){e.push(`Please enter a delivery date greater than today for item no ${r}`),n=!1;break}}else{e.push(`Please enter delivery date for item no ${r}`),n=!1;break}}}return n||e.forEach(a=>y({variant:"destructive",description:a})),{isValid:n,updatedMaterials:s}}}};export{T as L,C as a,U as u};
