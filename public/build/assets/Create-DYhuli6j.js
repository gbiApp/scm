import{r as f,W as J,j as e,Y as K,a as X}from"./app-lph7DMHm.js";import{A as Z}from"./AuthenticatedLayout-DhqJictr.js";import{T as E,a as F,b as x,c as h}from"./tabs-BJ7DHfAp.js";import{B as ee}from"./button-ChWVvjJW.js";import{T}from"./textarea-BW3f6LZR.js";import{L as p,I as j}from"./input-BUqrT3tp.js";import{S as k,a as w,b as S,c as q,d as P}from"./select-BhXz-d6f.js";import{S as te}from"./react-select.esm-CuOhGoD8.js";/* empty css              */import re from"./AddPrtoPo-DLue7s-p.js";import{N as ne,D as ae,T as le,a as ie,b as V,c as d}from"./constants-IZC2C-lU.js";import{D as oe}from"./Dropzone-DDfkiqCw.js";import{d as r}from"./index-utcn8n0A.js";import{u as se,T as de}from"./toaster-CPPgV8nI.js";import{f as ce}from"./utils-3WfyHtJO.js";import{C as me,a as ue}from"./card-CAJeGY2U.js";import"./ApplicationLogo-BGTFa63i.js";import"./transition-COqQaIw7.js";import"./x-B6V97zB8.js";import"./index-C-8tPshn.js";import"./index-Dfmoxwh8.js";import"./Combination-CTLHj_vv.js";import"./useStateManager-7e1e8489.esm-am5GhQpP.js";const Fe=({auth:u,vendors:b})=>{var W;const O=new Date().toLocaleDateString(),{toast:v}=se(),[y,R]=f.useState([]),[a,g]=f.useState([]),[o,C]=f.useState(),{data:s,setData:c,post:M,errors:N,reset:xe,processing:$}=J({id:0,po_number:void 0,control_no:void 0,vendor_id:void 0,vendor_name:"",created_name:u.user.name,doc_date:O,deliv_date:void 0,notes:"",plant:u.user.plants!==void 0?(W=u.user.plants[0])==null?void 0:W.plant:"",header_text:"",approver_text:"",attachment:void 0,total_po_value:0,status:"",appr_seq:0,deliv_addr:"",pomaterials:[]}),B=[{...r.keyColumn("sel",r.checkboxColumn),title:"Sel",minWidth:30},{...r.keyColumn("status",r.textColumn),title:"Sts",minWidth:35,disabled:!0},{...r.keyColumn("item_no",r.intColumn),title:"ItmNo",minWidth:55,disabled:!0},{...r.keyColumn("mat_code",r.textColumn),title:"Material",minWidth:120,disabled:!0},{...r.keyColumn("short_text",r.textColumn),title:"Short Text",minWidth:300,disabled:!0},{...r.keyColumn("po_qty",r.floatColumn),title:"PO Qty",minWidth:70},{...r.keyColumn("qty_open",r.floatColumn),title:"Open Qty",minWidth:100,disabled:!0},{...r.keyColumn("unit",r.textColumn),title:"Unit",minWidth:55},{...r.keyColumn("net_price",r.floatColumn),title:"Net Price",minWidth:80,disabled:({rowData:t})=>!!t.item_free},{...r.keyColumn("per_unit",r.intColumn),title:"Per Unit",minWidth:50,disabled:({rowData:t})=>!!t.item_free},{...r.keyColumn("total_value",r.intColumn),title:"Total Value",minWidth:120,disabled:!0},{...r.keyColumn("item_free",r.checkboxColumn),title:"Free",minWidth:70},{...r.keyColumn("currency",r.textColumn),title:"Curr",minWidth:55,disabled:!0},{...r.keyColumn("del_date",r.dateColumn),title:"Del Date",minWidth:120},{...r.keyColumn("mat_grp",r.textColumn),title:"Mat Grp",minWidth:200,disabled:!0},{...r.keyColumn("requested_by",r.textColumn),title:"Requested By",minWidth:150},{...r.keyColumn("pr_number",r.textColumn),title:"PR Number",minWidth:120,disabled:!0},{...r.keyColumn("pr_item",r.textColumn),title:"PRItm",minWidth:70,disabled:!0},{...r.keyColumn("item_text",r.textColumn),title:"Item Text",minWidth:300}],L={"--dsg-header-text-color":"rgb(10, 10, 10)","--dsg-cell-disabled-background-color":"rgb(245, 245, 245)","--dsg-border-color":"#bfbdbd"},H=t=>{g([...a,...t])},U=(t,l)=>{const m=[...t];console.log("updatedMaterial",m);for(const _ of l)if(_.type==="UPDATE"){const n=m[_.fromRowIndex];n.net_price=n.item_free?0:n.net_price,n.item_no=(_.fromRowIndex+1)*10,n.po_qty=n.po_qty<n.min_order_qty?n.min_order_qty:n.po_qty,n.po_qty=n.po_qty>n.qty_open?n.qty_open:n.po_qty,n.converted_qty=n.po_qty*(n.conversion/n.denominator),n.total_value=(n.net_price??0)/(n.per_unit??0)*(n.po_qty??0)}g(m),c({...s,pomaterials:m})};f.useEffect(()=>{const t=a.reduce((l,m)=>l+(m.total_value||0),0);c(l=>({...l,total_po_value:t,attachment:y}))},[a,y]),f.useEffect(()=>{N.hasOwnProperty("error")&&v({variant:"destructive",description:N.error})},[N]);const z=async t=>{try{C(void 0);const l=await window.axios.get(route("po.vendor",t));C(l.data.data)}catch(l){C(void 0),console.log("Error fetching vendor info: ",l)}},G=()=>{var _,n,D,I,A;const t=new Date;let l=!0;const m=a.filter(i=>i.mat_code!==void 0).map((i,Y)=>({...i,item_no:(Y+1)*10}));if(g(m),console.log("item",m),m.length<=0)return v({variant:"destructive",description:"Please add atleast 1 item"}),!1;for(let i=0;i<a.length;i++)if(a[i].mat_code!==void 0&&a[i].mat_code!==""){if(a[i].po_qty===void 0||((_=a[i])==null?void 0:_.po_qty)<=0){v({variant:"destructive",description:`Please enter quantity for item no ${a[i].item_no}`}),l=!1;break}if(a[i].unit===void 0||((n=a[i])==null?void 0:n.unit)===null){v({variant:"destructive",description:`Please enter order unit for item no ${a[i].item_no}`}),l=!1;break}if(a[i].net_price===void 0||((D=a[i])==null?void 0:D.net_price)===null){v({variant:"destructive",description:`Please enter Net Price for item no ${a[i].item_no}`}),l=!1;break}if(a[i].del_date===void 0||((I=a[i])==null?void 0:I.del_date)===null){v({variant:"destructive",description:`Please enter delivery date for item no ${a[i].item_no}`}),l=!1;break}else if(((A=a[i].del_date)==null?void 0:A.getTime())<=t.getTime()){v({variant:"destructive",description:`Please enter delivery date greater than today for item no ${a[i].item_no}`}),l=!1;break}}return l},Q=async t=>{t.preventDefault(),G()&&(console.log(s),M(route("po.store")))};return e.jsxs(Z,{user:u.user,menus:u.menu,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Create Purchase Order"}),children:[e.jsx(K,{title:"PO Create"}),e.jsx(de,{}),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-2",children:e.jsx("div",{className:"bg-gray-50 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"p-5 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(p,{htmlFor:"prnumber",children:"PO Number"}),e.jsx(j,{type:"text",id:"prnumber",defaultValue:s.po_number,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(p,{htmlFor:"control_no",children:"Control No."}),e.jsx(j,{type:"number",id:"control_no",defaultValue:s.control_no,onChange:t=>c("control_no",t.target.value)})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(p,{htmlFor:"created_by",children:"Created By"}),e.jsx(j,{type:"text",id:"control_no",defaultValue:s.created_name,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(p,{htmlFor:"date",children:"Doc Date"}),e.jsx(j,{type:"text",id:"date",defaultValue:s.doc_date,disabled:!0})]}),e.jsxs("div",{className:"flex-none w-40",children:[e.jsx(p,{htmlFor:"date",children:"Delivery Date"}),e.jsx(j,{type:"date",id:"deliv_date",defaultValue:s.deliv_date,onChange:t=>c("deliv_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"flex-none w-96",children:[e.jsx(p,{children:"Vendor"}),e.jsx(te,{required:!0,value:(b==null?void 0:b.find(({value:t})=>t===s.vendor_id))??null,options:b,onChange:({value:t,label:l})=>{c({...s,vendor_id:t,vendor_name:l}),z(t)},styles:{control:(t,l)=>({...t,minHeight:"1.75rem",height:"1.75rem",fontSize:"0.875rem",borderColor:"hsl(var(--input))"}),valueContainer:(t,l)=>({...t,height:"1.75rem",padding:"0 6px"}),input:(t,l)=>({...t,margin:"0px"}),indicatorSeparator:t=>({display:"none"}),indicatorsContainer:(t,l)=>({...t,height:"1.75rem"})}})]}),e.jsxs("div",{className:"flex-none w-52",children:[e.jsx(p,{htmlFor:"requestingPlant",children:"Requesting Plant"}),e.jsxs(k,{defaultValue:s.plant,onValueChange:t=>c("plant",t),children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Plant"})}),e.jsx(q,{children:u.user.plants&&u.user.plants.map(t=>e.jsxs(P,{value:t.plant,children:[t.plant," ",t.name1]},t.plant))})]})]})]}),e.jsx("div",{className:"p-1 pt-0",children:e.jsxs(E,{defaultValue:"header_text",className:"max-w-8xl",children:[e.jsxs(F,{children:[e.jsx(x,{value:"header_text",children:"Header Text"}),e.jsx(x,{value:"approver_text",children:"Approver Text"}),e.jsx(x,{value:"notes",children:"Notes"}),e.jsx(x,{value:"deliveryAddress",children:"Delivery Address"}),e.jsx(x,{value:"workflow",children:"Workflow"}),e.jsx(x,{value:"attachment",children:"Attachment"}),e.jsx(x,{value:"vendor",children:"Vendor Info"})]}),e.jsx(h,{value:"header_text",children:e.jsx(T,{value:s.header_text,onChange:t=>c("header_text",t.target.value)})}),e.jsx(h,{value:"notes",children:e.jsxs(k,{defaultValue:s.notes,onValueChange:t=>c("notes",t),children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Notes"})}),e.jsx(q,{children:ne.map(t=>e.jsx(P,{value:t,children:t},t))})]})}),e.jsx(h,{value:"deliveryAddress",children:e.jsxs(k,{defaultValue:s.deliv_addr,onValueChange:t=>c("deliv_addr",t),children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Address"})}),e.jsx(q,{children:ae.map(t=>e.jsx(P,{value:t,children:t},t))})]})}),e.jsx(h,{value:"approver_text",children:e.jsx(T,{value:s.approver_text,onChange:t=>c("approver_text",t.target.value)})}),e.jsx(h,{value:"workflow"}),e.jsx(h,{value:"attachment",children:e.jsx(oe,{files:y,setFiles:R})}),e.jsx(h,{value:"vendor",children:e.jsx(me,{children:e.jsx(ue,{children:o&&e.jsx("div",{children:e.jsx(le,{className:"w-11/2 text-sm",children:e.jsxs(ie,{children:[e.jsxs(V,{className:"border-none h-",children:[e.jsx(d,{children:e.jsx("b",{children:"Account group: "})}),e.jsx(d,{children:o.account_group}),e.jsx(d,{children:e.jsx("b",{children:"Name : "})}),e.jsxs(d,{children:[" ",o.name_1," ",o.name_2," ",o.name_3," ",o.name_4]}),e.jsx(d,{children:e.jsx("b",{children:"Supplier : "})}),e.jsx(d,{children:o.supplier})]},o.id),e.jsxs(V,{className:"border-none",children:[e.jsx(d,{children:e.jsx("b",{children:"Address : "})}),e.jsxs(d,{children:[o.street," ",o.district," ",o.city," ",o.postal_code," ",o.country]}),e.jsx(d,{children:e.jsx("b",{children:"Tax Number : "})}),e.jsxs(d,{children:[o.tax_number," ",o.tax_number_2]})]},o.id),e.jsxs(V,{className:"border-none",children:[e.jsx(d,{children:e.jsx("b",{children:"Telephone 1 : "})}),e.jsx(d,{children:o.telephone_1}),e.jsx(d,{children:e.jsx("b",{children:"Telephone 2 : "})}),e.jsx(d,{children:o.telephone_2})]},o.id)]})})})})})})]})}),e.jsx("div",{className:"p-2",children:e.jsx(r.DataSheetGrid,{value:a,onChange:U,columns:B,style:L,disableExpandSelection:!0,rowHeight:30,className:"text-sm"})}),e.jsxs("div",{className:"p-1 flex gap-2 justify-end content-center",children:[e.jsx("div",{className:"p-1",children:e.jsx(p,{htmlFor:"total",children:"Total PO Value: "})}),e.jsx("div",{children:e.jsx(j,{type:"text",value:ce(s.total_po_value),readOnly:!0,disabled:!0})})]}),e.jsxs("div",{className:"p-2 pt-0",children:[e.jsxs(E,{defaultValue:"ItemText",className:"max-w-xl",children:[e.jsx(F,{children:e.jsx(x,{value:"ItemText",children:"Item Text"})}),e.jsx(h,{value:"ItemText",children:e.jsx(T,{})})]}),e.jsx("div",{className:"p-5 justify-end grid grid-cols-8 gap-4",children:u.permissions.po.create&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{variant:"outline",disabled:$,className:"bg-[#f8c110]  hover:border-gray-500 hover:bg-[#f8c110]",children:"Save"}),e.jsx(X,{href:route("po.index"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-500",children:"Cancel"}),e.jsx(re,{p_vendor:s.vendor_id,p_plant:s.plant,p_created_name:s.created_name,p_doc_date:s.doc_date,addToPO:H})]})})]})]})})})})]})};export{Fe as default};
