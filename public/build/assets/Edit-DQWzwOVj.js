import{r as m,W as $,j as t,Y as ee,a as g}from"./app-9BfIP8Yt.js";import{D as te,S as se,T as A}from"./TabFields-CC_gKAQi.js";import{u as ie,a as ae,L as re}from"./usePRMaterialValidation-BCeaZwQX.js";import{s as D,I as _}from"./InputField-BbCt2qk6.js";import{G as E,A as le,F as y,D as oe}from"./AttachmentList-C4qDL1S6.js";import{f as ne,C as de,b as j,S as C,c as w,d as S}from"./constants-Co51-129.js";import{f as ue}from"./utils-BSdE8tDE.js";import"./tabs-CSAEFCKf.js";import{B as ce}from"./button-UluEiDe7.js";import{T as P}from"./textarea-WPr4wz2o.js";import{L as me,I as pe}from"./input-B6LatCgn.js";import{u as be,T as _e}from"./toaster-C-nH-nj2.js";import"./select-BlE8HqPq.js";import{A as fe}from"./AuthenticatedLayout-DNrtgEyS.js";import{d as i}from"./index-f1KWvzcE.js";/* empty css              */import k from"./Approval-BChJRyaA.js";import"./toast-SiKyGAR4.js";import"./index-CzvjeGZW.js";import"./react-select.esm-R1G1BB6e.js";import"./useStateManager-7e1e8489.esm-9tTtCMRh.js";import"./Modal-DTHE29Ut.js";import"./transition-6Z6DAD7I.js";import"./SecondaryButton-Cc1rzZy3.js";import"./ApplicationLogo-BHU32V6c.js";import"./PrimaryButton-BuizIAGH.js";const Be=({auth:d,prheader:s,mat_code:W,mat_desc:q,message:u,item_details:F})=>{var R;const{toast:f}=be(),[r,x]=m.useState(s.prmaterials.map(e=>{var o;return{...e,mat_grp_desc:((o=e.materialGroups)==null?void 0:o.mat_grp_desc)||"",del_date:new Date(e.del_date||""),altUomSelect:[...new Set([e.ord_unit,...e.alt_uom?e.alt_uom.map(n=>n.alt_uom):[]])]}})),[T,M]=m.useState([]),[v,N]=m.useState([]),[c,U]=m.useState(),{updateMaterialPR:V,computeConversion:L,isLoading:O}=ie(),{validateMaterials:I}=ae(),{data:l,setData:b,post:B,errors:h,reset:G,processing:H}=$({id:s.id,pr_number:s.pr_number,created_name:s.created_name,doc_date:s.doc_date,attachment:void 0,requested_by:s.requested_by,plant:s.plant,reason_pr:s.reason_pr,header_text:s.header_text??"",total_pr_value:s.total_pr_value,status:s.status||"",deliv_addr:s.deliv_addr,prmaterials:[],attachments:[],_method:"patch"}),K=m.useMemo(()=>[{...i.keyColumn("sel",i.checkboxColumn),title:"Sel",minWidth:30},{...i.keyColumn("status",i.textColumn),title:"Sts",disabled:!0,minWidth:35},{...i.keyColumn("item_no",i.intColumn),title:"ItmNo",disabled:!0,minWidth:55},{...i.keyColumn("mat_code",D({choices:W})),title:"Material",minWidth:120},{...i.keyColumn("short_text",D({choices:q})),title:"Short Text",minWidth:300},{...i.keyColumn("item_text",i.textColumn),title:"Item Text",minWidth:300},{...i.keyColumn("qty",i.floatColumn),title:"Qty",minWidth:70,disabled:({rowData:e})=>e.qty_ordered>0},{...i.keyColumn("altUomSelect",{component:({rowData:e,rowIndex:o})=>e&&t.jsx("select",{className:"border-none w-full shadow-none bg-none px-1 py-0 active:border-none hover:border-none",onChange:n=>{x(a=>{const p=[...a];return p[o]={...p[o],...L(p[o],n.target.value)},p})},children:e.map((n,a)=>t.jsx("option",{value:n,children:n},a))})}),title:"Alt UOM",minWidth:100},{...i.keyColumn("ord_unit",i.textColumn),title:"Ord UOM",minWidth:55,disabled:({rowData:e})=>e.mat_code&&e.mat_code[0].toUpperCase()!=="S"},{...i.keyColumn("price",i.floatColumn),title:"Price",minWidth:90,disabled:({rowData:e})=>e.mat_code&&e.mat_code[0].toUpperCase()!=="S"},{...i.keyColumn("per_unit",i.floatColumn),title:"Per Unit",minWidth:50,disabled:({rowData:e})=>e.mat_code&&e.mat_code[0].toUpperCase()!=="S"},{...i.keyColumn("unit",i.textColumn),title:"B.UOM",minWidth:60,disabled:!0},{...i.keyColumn("total_value",i.floatColumn),title:"Total Value",minWidth:120,disabled:!0},{...i.keyColumn("currency",i.textColumn),title:"Curr",minWidth:40,disabled:!0},{...i.keyColumn("del_date",i.dateColumn),title:"Del Date",minWidth:130},{...i.keyColumn("mat_grp_desc",i.textColumn),title:"Mat Grp",minWidth:100,disabled:!0},{...i.keyColumn("purch_grp",i.textColumn),title:"Purch Grp",minWidth:90,disabled:!0}],[]),Q=m.useMemo(()=>[{header:"Position",accessor:e=>e.position},{header:"Status",accessor:e=>e.status},{header:"Approved By",accessor:e=>e.approved_by},{header:"Approved Date",accessor:e=>e.approved_date},{header:"Remarks",accessor:e=>e.message}],[]),Y=[{value:"reasonForPr",label:"Reason for PR",visible:!0,content:t.jsx(P,{value:l.reason_pr,onChange:e=>b("reason_pr",e.target.value),required:!0})},{value:"headerText",label:"Header Text",visible:!0,content:t.jsx(P,{value:l.header_text,onChange:e=>b("header_text",e.target.value)})},{value:"workflow",label:"Workflow",visible:((R=s.workflows)==null?void 0:R.length)>0,content:t.jsx(E,{columns:Q,data:s.workflows,className:"w-11/2 text-xs bg-white"})},{value:"attachment",label:"Attachment",visible:!0,content:t.jsxs(t.Fragment,{children:[t.jsx(le,{attachments:s.attachments,canEdit:d.permissions.pr.edit}),t.jsx(te,{files:v,setFiles:N})]})}],z=[{header:"Document",accessor:e=>e.doc},{header:"Item",accessor:e=>e.itm},{header:"Status",accessor:e=>e.sts},{header:"Quantity",accessor:e=>e.qty},{header:"Unit",accessor:e=>e.unit}],J=[{value:"itemDetails",label:"Item Details",visible:T.length>0,content:t.jsx(E,{columns:z,data:T,className:"w-11/2 text-xs bg-white"})},{value:"action",label:"Action",visible:d.permissions.pr.edit,content:t.jsxs("div",{children:[t.jsx(y,{p_description:"Remove flag for this item(s)?",p_title:"Remove Flag",p_url:route("pr.flag.remove"),p_disable:r.filter(e=>e.sel==!0).length==0,p_items:{ids:r.filter(e=>e.sel==!0).map(e=>e.id)}}),t.jsx(y,{p_description:"Flag delete this item(s)?",p_title:"Flag Delete",p_url:route("pr.flag.delete"),p_disable:r.filter(e=>e.sel==!0).length==0,p_items:{ids:r.filter(e=>e.sel==!0).map(e=>e.id)}}),t.jsx(y,{p_description:"Flag close this item(s)?",p_title:"Flag Close",p_url:route("pr.flag.close"),p_disable:r.filter(e=>e.sel==!0).length==0,p_items:{ids:r.filter(e=>e.sel==!0).map(e=>e.id)}})]})}],X=async(e,o)=>{const n=await V(e,o,r,l.plant);x(n)},Z=async e=>{e.preventDefault();const{isValid:o,updatedMaterials:n}=I(r);x(n),o&&B(route("pr.update",s.id),{preserveScroll:!0,onSuccess:a=>{G(),N([])}})};return m.useEffect(()=>{u!=null&&u.success&&f({title:u.success}),u!=null&&u.error&&f({variant:"destructive",title:u.error}),d.user.approvers&&U(d.user.approvers.filter(e=>e.type=="pr")[0])},[u]),m.useEffect(()=>{const e=r.filter(a=>(a==null?void 0:a.status)!="X").reduce((a,p)=>a+(p.total_value||0),0),o=r.filter(a=>a.sel==!0).map(a=>a.mat_code)[0],n=F.filter(a=>a.mat_code==o);b(a=>({...a,total_pr_value:e,attachment:v,prmaterials:r})),M(n)},[r,v]),m.useEffect(()=>{h.hasOwnProperty("error")&&f({variant:"destructive",description:h.error})},[h]),t.jsxs(fe,{user:d.user,menus:d.menu,header:t.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Edit Purchase Requisition"}),children:[t.jsx(ee,{title:"PR Edit"}),O&&t.jsx(re,{}),t.jsx(_e,{}),t.jsx("div",{className:"py-2",children:t.jsx("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-2",children:t.jsxs("div",{className:"bg-gray-50 overflow-hidden shadow-sm sm:rounded-lg",children:[t.jsxs("form",{onSubmit:Z,children:[t.jsxs("div",{className:"p-5 flex flex-wrap gap-4",children:[t.jsx(_,{label:"PR Number",id:"prnumber",defaultValue:l.pr_number,disabled:!0}),t.jsx(_,{label:"Created By",id:"createdby",defaultValue:l.created_name,disabled:!0}),t.jsx(_,{label:"Date",id:"date",defaultValue:l.doc_date,disabled:!0}),t.jsx(_,{label:"Requested By",id:"requested_by",value:l.requested_by,required:!0,onChange:e=>b("requested_by",e.target.value)}),t.jsx(se,{label:"Requesting Plant",items:d.user.plants,valueKey:"plant",displayKey:"name1",onValueChange:e=>b("plant",e),value:l.plant})]}),t.jsx("div",{className:"p-5",children:t.jsx(A,{defaultValue:"reasonForPr",className:"max-w-8xl",tabs:Y})}),t.jsx("div",{className:"p-2",children:t.jsx(i.DataSheetGrid,{createRow:()=>ne,value:r,onChange:X,columns:K,style:de,disableExpandSelection:!0,rowHeight:30,className:"text-sm"})}),t.jsxs("div",{className:"float-right -mt-12 mr-72  flex gap-2 justify-end content-center",children:[t.jsx("div",{className:"",children:t.jsx(me,{htmlFor:"total",children:"Total PR Value: "})}),t.jsx("div",{children:t.jsx(pe,{type:"text",value:ue(l.total_pr_value),readOnly:!0,disabled:!0})})]}),t.jsxs("div",{className:"p-2 pt-0",children:[t.jsx(A,{defaultValue:"itemDetails",className:"max-w-8xl",tabs:J}),t.jsx("div",{className:"p-5 justify-end grid grid-cols-8 gap-4",children:d.permissions.pr.edit&&t.jsxs(t.Fragment,{children:[t.jsx(ce,{type:"submit",variant:"outline",className:"bg-[#f8c110]  hover:border-gray-500 hover:bg-[#f8c110] disabled:cursor-not-allowed disabled:opacity-100 disabled:bg-gray-100",disabled:s.appr_seq!=j||H,children:"Save"}),t.jsx(g,{href:route("pr.index"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2  border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-500 disabled:cursor-not-allowed disabled:opacity-100",children:"Cancel"}),t.jsx(g,{disabled:s.appr_seq!=j,preserveScroll:!0,href:route("pr.submit",s.id),as:"button",type:"button",className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none border border-input bg-[#f8c110] hover:bg-[#f8c110] hover:text-accent-foreground hover:border-gray-500
                        disabled:cursor-not-allowed disabled:opacity-100 disabled:bg-gray-100 `,children:"Submit"}),t.jsx(oe,{p_id:s.id,p_disable:s.appr_seq!=j,p_title:"Discard this Purchase Requisition ?",p_url:"pr.discard"}),t.jsx(g,{preserveScroll:!0,href:route("pr.recall",s.id),as:"button",type:"button",className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2  border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-gray-500 disabled:cursor-not-allowed disabled:opacity-100 disabled:bg-gray-100",children:"Recall"})]})})]})]}),d.permissions.pr.approver&&t.jsxs("div",{className:"px-5 pb-5",children:[t.jsx(k,{p_pr_number:l.pr_number,p_type:"approved",p_title:"approve",p_disable:s.status==C||s.status==w||s.status==S||(c==null?void 0:c.seq)!=s.appr_seq}),t.jsx(k,{p_pr_number:l.pr_number,p_type:"rework",p_title:"rework",p_disable:s.status==C||s.status==w||s.status==S||(c==null?void 0:c.seq)!=s.appr_seq}),t.jsx(k,{p_pr_number:l.pr_number,p_type:"rejected",p_title:"reject",p_disable:s.status==C||s.status==w||s.status==S||(c==null?void 0:c.seq)!=s.appr_seq})]})]})})})]})};export{Be as default};
